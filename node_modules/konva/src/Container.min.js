!function(){"use strict";Konva.Container=function(e){this.__init(e)},Konva.Util.addMethods(Konva.Container,{__init:function(e){this.children=new Konva.Collection,Konva.Node.call(this,e)},getChildren:function(e){if(!e)return this.children;var t=new Konva.Collection;return this.children.each(function(r){e(r)&&t.push(r)}),t},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){for(var t,e=Konva.Collection.toCollection(this.children),r=0;r<e.length;r++)t=e[r],delete t.parent,t.index=0,t.remove();return e=null,this.children=new Konva.Collection,this},destroyChildren:function(){for(var t,e=Konva.Collection.toCollection(this.children),r=0;r<e.length;r++)t=e[r],delete t.parent,t.index=0,t.destroy();return e=null,this.children=new Konva.Collection,this},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}if(e.getParent())return e.moveTo(this),this;var r=this.children;return this._validateAdd(e),e.index=r.length,e.parent=this,r.push(e),this._fire("add",{child:e}),Konva.DD&&e.isDragging()&&Konva.DD.anim.setLayers(e.getLayer()),this},destroy:function(){return this.hasChildren()&&this.destroyChildren(),Konva.Node.prototype.destroy.call(this),this},find:function(e){var n,s,a,o,u,c,h,t=[],r=e.replace(/ /g,"").split(","),i=r.length;for(n=0;i>n;n++)if(a=r[n],Konva.Util.isValidSelector(a)||(Konva.Util.warn('Selector "'+a+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),Konva.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),Konva.Util.warn("Konva is awesome, right?")),"#"===a.charAt(0))u=this._getNodeById(a.slice(1)),u&&t.push(u);else if("."===a.charAt(0))o=this._getNodesByName(a.slice(1)),t=t.concat(o);else for(c=this.getChildren(),h=c.length,s=0;h>s;s++)t=t.concat(c[s]._get(a));return Konva.Collection.toCollection(t)},findOne:function(e){return this.find(e)[0]},_getNodeById:function(e){var t=Konva.ids[e];return void 0!==t&&this.isAncestorOf(t)?t:null},_getNodesByName:function(e){var t=Konva.names[e]||[];return this._getDescendants(t)},_get:function(e){for(var t=Konva.Node.prototype._get.call(this,e),r=this.getChildren(),i=r.length,n=0;i>n;n++)t=t.concat(r[n]._get(e));return t},toObject:function(){var e=Konva.Node.prototype.toObject.call(this);e.children=[];for(var t=this.getChildren(),r=t.length,i=0;r>i;i++){var n=t[i];e.children.push(n.toObject())}return e},_getDescendants:function(e){for(var t=[],r=e.length,i=0;r>i;i++){var n=e[i];this.isAncestorOf(n)&&t.push(n)}return t},isAncestorOf:function(e){for(var t=e.getParent();t;){if(t._id===this._id)return!0;t=t.getParent()}return!1},clone:function(e){var t=Konva.Node.prototype.clone.call(this,e);return this.getChildren().each(function(e){t.add(e.clone())}),t},getAllIntersections:function(e){var t=[];return this.find("Shape").each(function(r){r.isVisible()&&r.intersects(e)&&t.push(r)}),t},_setChildrenIndices:function(){this.children.each(function(e,t){e.index=t})},drawScene:function(e,t,r){var i=this.getLayer(),n=e||i&&i.getCanvas(),s=n&&n.getContext(),a=this._cache.canvas,o=a&&a.scene;return this.isVisible()&&(!r&&o?(s.save(),i._applyTransform(this,s,t),this._drawCachedSceneCanvas(s),s.restore()):this._drawChildren(n,"drawScene",t,!1,r)),this},drawHit:function(e,t,r){var i=this.getLayer(),n=e||i&&i.hitCanvas,s=n&&n.getContext(),a=this._cache.canvas,o=a&&a.hit;return this.shouldDrawHit(n)&&(i&&i.clearHitCache(),!r&&o?(s.save(),i._applyTransform(this,s,t),this._drawCachedHitCanvas(s),s.restore()):this._drawChildren(n,"drawHit",t)),this},_drawChildren:function(e,t,r,i,n){var l,f,s=this.getLayer(),a=e&&e.getContext(),o=this.getClipWidth(),u=this.getClipHeight(),c=this.getClipFunc(),h=o&&u||c;if(h&&s){a.save();var p=this.getAbsoluteTransform(r),d=p.getMatrix();a.transform(d[0],d[1],d[2],d[3],d[4],d[5]),a.beginPath(),c?c.call(this,a,this):(l=this.getClipX(),f=this.getClipY(),a.rect(l,f,o,u)),a.clip(),d=p.copy().invert().getMatrix(),a.transform(d[0],d[1],d[2],d[3],d[4],d[5])}this.children.each(function(s){s[t](e,r,i,n)}),h&&a.restore()},shouldDrawHit:function(e){var t=this.getLayer(),r=Konva.DD,i=r&&Konva.isDragging()&&-1!==Konva.DD.anim.getLayers().indexOf(t);return e&&e.isCache||t&&t.hitGraphEnabled()&&this.isVisible()&&!i},getClientRect:function(e){var t,r,i,n,s={x:0,y:0,width:0,height:0};return this.children.each(function(e){var s=e.getClientRect();void 0===t?(t=s.x,r=s.y,i=s.x+s.width,n=s.y+s.height):(t=Math.min(t,s.x),r=Math.min(r,s.y),i=Math.max(i,s.x+s.width),n=Math.max(n,s.y+s.height))}),0!==this.children.length&&(s={x:t,y:r,width:i-t,height:n-r}),e?s:this._transformedRect(s)}}),Konva.Util.extend(Konva.Container,Konva.Node),Konva.Container.prototype.get=Konva.Container.prototype.find,Konva.Factory.addComponentsGetterSetter(Konva.Container,"clip",["x","y","width","height"]),Konva.Factory.addGetterSetter(Konva.Container,"clipX"),Konva.Factory.addGetterSetter(Konva.Container,"clipY"),Konva.Factory.addGetterSetter(Konva.Container,"clipWidth"),Konva.Factory.addGetterSetter(Konva.Container,"clipHeight"),Konva.Factory.addGetterSetter(Konva.Container,"clipFunc"),Konva.Collection.mapMethods(Konva.Container)}();
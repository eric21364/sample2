var crypto=require("crypto"),Base64Id=function(){};Base64Id.prototype.getRandomBytes=function(t){var e=4096,r=this;if(t=t||12,t>e)return crypto.randomBytes(t);var i=parseInt(e/t),n=parseInt(.85*i);if(!n)return crypto.randomBytes(t);if(null==this.bytesBufferIndex&&(this.bytesBufferIndex=-1),this.bytesBufferIndex==i&&(this.bytesBuffer=null,this.bytesBufferIndex=-1),(-1==this.bytesBufferIndex||this.bytesBufferIndex>n)&&(this.isGeneratingBytes||(this.isGeneratingBytes=!0,crypto.randomBytes(e,function(t,e){r.bytesBuffer=e,r.bytesBufferIndex=0,r.isGeneratingBytes=!1})),-1==this.bytesBufferIndex))return crypto.randomBytes(t);var s=this.bytesBuffer.slice(t*this.bytesBufferIndex,t*(this.bytesBufferIndex+1));return this.bytesBufferIndex++,s},Base64Id.prototype.generateId=function(){var t=new Buffer(15);return t.writeInt32BE?(this.sequenceNumber=this.sequenceNumber+1|0,t.writeInt32BE(this.sequenceNumber,11),crypto.randomBytes?this.getRandomBytes(12).copy(t):[0,4,8].forEach(function(e){t.writeInt32BE(Math.random()*Math.pow(2,32)|0,e)}),t.toString("base64").replace(/\//g,"_").replace(/\+/g,"-")):Math.abs(Math.random()*Math.random()*Date.now()|0).toString()+Math.abs(Math.random()*Math.random()*Date.now()|0).toString()},exports=module.exports=new Base64Id;
function PoolNamespace(e,t,r){this._cluster=e,this._pattern=t,this._selector=new PoolSelector[r]}var Connection=require("./Connection"),PoolSelector=require("./PoolSelector");module.exports=PoolNamespace,PoolNamespace.prototype.getConnection=function(e){var t=this._getClusterNode(),r=this._cluster,i=this;if(null===t){var n=null;return 0!==this._cluster._findNodeIds(this._pattern,!0).length?(n=new Error("Pool does not have online node."),n.code="POOL_NONEONLINE"):(n=new Error("Pool does not exist."),n.code="POOL_NOEXIST"),void e(n)}r._getConnection(t,function(t,n){var s=t&&r._canRetry&&0!==r._findNodeIds(i._pattern).length;return s?void i.getConnection(e):t?void e(t):void e(null,n)})},PoolNamespace.prototype.query=function(e,t,r){var i=this._cluster,n=this._getClusterNode(),s=Connection.createQuery(e,t,r),a=this;if(null===n){var o=null;return 0!==this._cluster._findNodeIds(this._pattern,!0).length?(o=new Error("Pool does not have online node."),o.code="POOL_NONEONLINE"):(o=new Error("Pool does not exist."),o.code="POOL_NOEXIST"),process.nextTick(function(){s.on("error",function(){}),s.end(o)}),s}return"object"==typeof e&&"typeCast"in e||(s.typeCast=n.pool.config.connectionConfig.typeCast),n.pool.config.connectionConfig.trace&&(s._callSite=new Error),i._getConnection(n,function(e,t){var r=e&&i._canRetry&&0!==i._findNodeIds(a._pattern).length;return r?void a.query(s):e?(s.on("error",function(){}),void s.end(e)):(s.once("end",function(){t.release()}),void t.query(s))}),s},PoolNamespace.prototype._getClusterNode=function(){var t,e=this._cluster._findNodeIds(this._pattern);switch(e.length){case 0:t=null;break;case 1:t=e[0];break;default:t=this._selector(e)}return null!==t?this._cluster._getNode(t):null};
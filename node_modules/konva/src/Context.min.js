!function(){"use strict";var e=",",t="(",r=")",i="([",n="])",s=";",a="()",o="=",c=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],u=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation"];Konva.Context=function(e){this.init(e)},Konva.Context.prototype={init:function(e){this.canvas=e,this._context=e._canvas.getContext("2d"),Konva.enableTrace&&(this.traceArr=[],this._enableTrace())},fillShape:function(e){e.getFillEnabled()&&this._fill(e)},strokeShape:function(e){e.getStrokeEnabled()&&this._stroke(e)},fillStrokeShape:function(e){var t=e.getFillEnabled();t&&this._fill(e),e.getStrokeEnabled()&&this._stroke(e)},getTrace:function(c){var f,p,d,v,u=this.traceArr,h=u.length,l="";for(f=0;h>f;f++)p=u[f],d=p.method,d?(v=p.args,l+=d,l+=c?a:Konva.Util._isArray(v[0])?i+v.join(e)+n:t+v.join(e)+r):(l+=p.property,c||(l+=o+p.val)),l+=s;return l},clearTrace:function(){this.traceArr=[]},_trace:function(e){var r,t=this.traceArr;t.push(e),r=t.length,r>=Konva.traceArrMax&&t.shift()},reset:function(){var e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)},getCanvas:function(){return this.canvas},clear:function(e){var t=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,t.getWidth()/t.pixelRatio,t.getHeight()/t.pixelRatio)},_applyLineCap:function(e){var t=e.getLineCap();t&&this.setAttr("lineCap",t)},_applyOpacity:function(e){var t=e.getAbsoluteOpacity();1!==t&&this.setAttr("globalAlpha",t)},_applyLineJoin:function(e){var t=e.getLineJoin();t&&this.setAttr("lineJoin",t)},setAttr:function(e,t){this._context[e]=t},arc:function(){var e=arguments;this._context.arc(e[0],e[1],e[2],e[3],e[4],e[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var e=arguments;this._context.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5])},clearRect:function(){var e=arguments;this._context.clearRect(e[0],e[1],e[2],e[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createImageData:function(){var e=arguments;return 2===e.length?this._context.createImageData(e[0],e[1]):1===e.length?this._context.createImageData(e[0]):void 0},createLinearGradient:function(){var e=arguments;return this._context.createLinearGradient(e[0],e[1],e[2],e[3])},createPattern:function(){var e=arguments;return this._context.createPattern(e[0],e[1])},createRadialGradient:function(){var e=arguments;return this._context.createRadialGradient(e[0],e[1],e[2],e[3],e[4],e[5])},drawImage:function(){var e=arguments,t=this._context;3===e.length?t.drawImage(e[0],e[1],e[2]):5===e.length?t.drawImage(e[0],e[1],e[2],e[3],e[4]):9===e.length&&t.drawImage(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},isPointInPath:function(e,t){return this._context.isPointInPath(e,t)},fill:function(){this._context.fill()},fillRect:function(e,t,r,i){this._context.fillRect(e,t,r,i)},strokeRect:function(e,t,r,i){this._context.strokeRect(e,t,r,i)},fillText:function(){var e=arguments;this._context.fillText(e[0],e[1],e[2])},measureText:function(e){return this._context.measureText(e)},getImageData:function(){var e=arguments;return this._context.getImageData(e[0],e[1],e[2],e[3])},lineTo:function(){var e=arguments;this._context.lineTo(e[0],e[1])},moveTo:function(){var e=arguments;this._context.moveTo(e[0],e[1])},rect:function(){var e=arguments;this._context.rect(e[0],e[1],e[2],e[3])},putImageData:function(){var e=arguments;this._context.putImageData(e[0],e[1],e[2])},quadraticCurveTo:function(){var e=arguments;this._context.quadraticCurveTo(e[0],e[1],e[2],e[3])},restore:function(){this._context.restore()},rotate:function(){var e=arguments;this._context.rotate(e[0])},save:function(){this._context.save()},scale:function(){var e=arguments;this._context.scale(e[0],e[1])},setLineDash:function(){var e=arguments,t=this._context;this._context.setLineDash?t.setLineDash(e[0]):"mozDash"in t?t.mozDash=e[0]:"webkitLineDash"in t&&(t.webkitLineDash=e[0])},getLineDash:function(){return this._context.getLineDash()},setTransform:function(){var e=arguments;this._context.setTransform(e[0],e[1],e[2],e[3],e[4],e[5])},stroke:function(){this._context.stroke()},strokeText:function(){var e=arguments;this._context.strokeText(e[0],e[1],e[2])},transform:function(){var e=arguments;this._context.transform(e[0],e[1],e[2],e[3],e[4],e[5])},translate:function(){var e=arguments;this._context.translate(e[0],e[1])},_enableTrace:function(){var n,s,e=this,t=c.length,r=Konva.Util._simplifyArray,i=this.setAttr,a=function(t){var n,i=e[t];e[t]=function(){return s=r(Array.prototype.slice.call(arguments,0)),n=i.apply(e,arguments),e._trace({method:t,args:s}),n}};for(n=0;t>n;n++)a(c[n]);e.setAttr=function(){i.apply(e,arguments);var t=arguments[0],r=arguments[1];("shadowOffsetX"===t||"shadowOffsetY"===t||"shadowBlur"===t)&&(r/=this.canvas.getPixelRatio()),e._trace({property:t,val:r})}}},u.forEach(function(e){Object.defineProperty(Konva.Context.prototype,e,{get:function(){return this._context[e]},set:function(t){this._context[e]=t}})}),Konva.SceneContext=function(e){Konva.Context.call(this,e)},Konva.SceneContext.prototype={_fillColor:function(e){var t=e.fill();this.setAttr("fillStyle",t),e._fillFunc(this)},_fillPattern:function(e){var t=e.getFillPatternX(),r=e.getFillPatternY(),i=e.getFillPatternScale(),n=Konva.getAngle(e.getFillPatternRotation()),s=e.getFillPatternOffset();(t||r)&&this.translate(t||0,r||0),n&&this.rotate(n),i&&this.scale(i.x,i.y),s&&this.translate(-1*s.x,-1*s.y),this.setAttr("fillStyle",this.createPattern(e.getFillPatternImage(),e.getFillPatternRepeat()||"repeat")),this.fill()},_fillLinearGradient:function(e){var t=e.getFillLinearGradientStartPoint(),r=e.getFillLinearGradientEndPoint(),i=e.getFillLinearGradientColorStops(),n=this.createLinearGradient(t.x,t.y,r.x,r.y);if(i){for(var s=0;s<i.length;s+=2)n.addColorStop(i[s],i[s+1]);this.setAttr("fillStyle",n),e._fillFunc(this)}},_fillRadialGradient:function(e){for(var t=e.getFillRadialGradientStartPoint(),r=e.getFillRadialGradientEndPoint(),i=e.getFillRadialGradientStartRadius(),n=e.getFillRadialGradientEndRadius(),s=e.getFillRadialGradientColorStops(),a=this.createRadialGradient(t.x,t.y,i,r.x,r.y,n),o=0;o<s.length;o+=2)a.addColorStop(s[o],s[o+1]);this.setAttr("fillStyle",a),this.fill()},_fill:function(e){var t=e.fill(),r=e.getFillPatternImage(),i=e.getFillLinearGradientColorStops(),n=e.getFillRadialGradientColorStops(),s=e.getFillPriority();t&&"color"===s?this._fillColor(e):r&&"pattern"===s?this._fillPattern(e):i&&"linear-gradient"===s?this._fillLinearGradient(e):n&&"radial-gradient"===s?this._fillRadialGradient(e):t?this._fillColor(e):r?this._fillPattern(e):i?this._fillLinearGradient(e):n&&this._fillRadialGradient(e)},_stroke:function(e){var t=e.dash(),r=e.getStrokeScaleEnabled()||e instanceof Konva.Text;e.hasStroke()&&(r||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(e),t&&e.dashEnabled()&&(this.setLineDash(t),this.setAttr("lineDashOffset",e.dashOffset())),this.setAttr("lineWidth",e.strokeWidth()),this.setAttr("strokeStyle",e.stroke()),e.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),e._strokeFunc(this),r||this.restore())},_applyShadow:function(e){var t=Konva.Util,r=t.get(e.getShadowRGBA(),"black"),i=t.get(e.getShadowBlur(),5),n=t.get(e.getShadowOffset(),{x:0,y:0}),s=e.getAbsoluteScale(),a=this.canvas.getPixelRatio(),o=s.x*a,c=s.y*a;this.setAttr("shadowColor",r),this.setAttr("shadowBlur",i*a*Math.min(Math.abs(o),Math.abs(c))),this.setAttr("shadowOffsetX",n.x*o),this.setAttr("shadowOffsetY",n.y*c)},_applyGlobalCompositeOperation:function(e){var t=e.getGlobalCompositeOperation();"source-over"!==t&&this.setAttr("globalCompositeOperation",t)}},Konva.Util.extend(Konva.SceneContext,Konva.Context),Konva.HitContext=function(e){Konva.Context.call(this,e)},Konva.HitContext.prototype={_fill:function(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()},_stroke:function(e){if(e.hasStroke()&&e.strokeHitEnabled()){var t=e.getStrokeScaleEnabled()||e instanceof Konva.Text;t||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(e),this.setAttr("lineWidth",e.strokeWidth()),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this),t||this.restore()}}},Konva.Util.extend(Konva.HitContext,Konva.Context)}();
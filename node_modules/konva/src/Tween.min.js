!function(){"use strict";var e={node:1,duration:1,easing:1,onFinish:1,yoyo:1},t=1,r=2,i=3,n=0,s=["fill","stroke","shadowColor"],a=function(e,t,r,i,n,s,a){this.prop=e,this.propFunc=t,this.begin=i,this._pos=i,this.duration=s,this._change=0,this.prevPos=0,this.yoyo=a,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=r,this._change=n-this.begin,this.pause()};a.prototype={fire:function(e){var t=this[e];t&&t()},setTime:function(e){e>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>e?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=e,this.update())},getTime:function(){return this._time},setPosition:function(e){this.prevPos=this._pos,this.propFunc(e),this._pos=e},getPosition:function(e){return void 0===e&&(e=this._time),this.func(e,this.begin,this._change,this.duration)},play:function(){this.state=r,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},reverse:function(){this.state=i,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},seek:function(e){this.pause(),this._time=e,this.update(),this.fire("onSeek")},reset:function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},finish:function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var e=this.getTimer()-this._startTime;this.state===r?this.setTime(e):this.state===i&&this.setTime(this.duration-e)},pause:function(){this.state=t,this.fire("onPause")},getTimer:function(){return(new Date).getTime()}},Konva.Tween=function(t){var o,u,r=this,i=t.node,s=i._id,h=t.easing||Konva.Easings.Linear,c=!!t.yoyo;o="undefined"==typeof t.duration?1:0===t.duration?.001:t.duration,this.node=i,this._id=n++;var l=i.getLayer()||(i instanceof Konva.Stage?i.getLayers():null);l||Konva.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new Konva.Animation(function(){r.tween.onEnterFrame()},l),this.tween=new a(u,function(e){r._tweenFunc(e)},h,0,1,1e3*o,c),this._addListeners(),Konva.Tween.attrs[s]||(Konva.Tween.attrs[s]={}),Konva.Tween.attrs[s][this._id]||(Konva.Tween.attrs[s][this._id]={}),Konva.Tween.tweens[s]||(Konva.Tween.tweens[s]={});for(u in t)void 0===e[u]&&this._addAttr(u,t[u]);this.reset(),this.onFinish=t.onFinish,this.onReset=t.onReset},Konva.Tween.attrs={},Konva.Tween.tweens={},Konva.Tween.prototype={_addAttr:function(e,t){var n,a,o,h,c,u,l,r=this.node,i=r._id;if(o=Konva.Tween.tweens[i][e],o&&delete Konva.Tween.attrs[i][o][e],n=r.getAttr(e),Konva.Util._isArray(t))for(a=[],c=Math.max(t.length,n.length),"points"===e&&t.length!==n.length&&(t.length>n.length?(l=n,n=Konva.Util._prepareArrayForTween(n,t,r.closed())):(u=t,t=Konva.Util._prepareArrayForTween(t,n,r.closed()))),h=0;c>h;h++)a.push(t[h]-n[h]);else if(-1!==s.indexOf(e)){n=Konva.Util.colorToRGBA(n);var f=Konva.Util.colorToRGBA(t);a={r:f.r-n.r,g:f.g-n.g,b:f.b-n.b,a:f.a-n.a}}else a=t-n;Konva.Tween.attrs[i][this._id][e]={start:n,diff:a,end:t,trueEnd:u,trueStart:l},Konva.Tween.tweens[i][e]=this._id},_tweenFunc:function(e){var i,n,a,o,h,c,u,l,t=this.node,r=Konva.Tween.attrs[t._id][this._id];for(i in r){if(n=r[i],a=n.start,o=n.diff,l=n.end,Konva.Util._isArray(a))for(h=[],u=Math.max(a.length,l.length),c=0;u>c;c++)h.push((a[c]||0)+o[c]*e);else h=-1!==s.indexOf(i)?"rgba("+Math.round(a.r+o.r*e)+","+Math.round(a.g+o.g*e)+","+Math.round(a.b+o.b*e)+","+(a.a+o.a*e)+")":a+o*e;t.setAttr(i,h)}},_addListeners:function(){var e=this;this.tween.onPlay=function(){e.anim.start()},this.tween.onReverse=function(){e.anim.start()},this.tween.onPause=function(){e.anim.stop()},this.tween.onFinish=function(){var t=e.node,r=Konva.Tween.attrs[t._id][e._id];r.points&&r.points.trueEnd&&t.points(r.points.trueEnd),e.onFinish&&e.onFinish.call(e)},this.tween.onReset=function(){var t=e.node,r=Konva.Tween.attrs[t._id][e._id];r.points&&r.points.trueStart&&t.points(r.points.trueStart),e.onReset&&e.onReset()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){return this.tween.reset(),this},seek:function(e){return this.tween.seek(1e3*e),this},pause:function(){return this.tween.pause(),this},finish:function(){return this.tween.finish(),this},destroy:function(){var i,e=this.node._id,t=this._id,r=Konva.Tween.tweens[e];this.pause();for(i in r)delete Konva.Tween.tweens[e][i];delete Konva.Tween.attrs[e][t]}},Konva.Node.prototype.to=function(e){var t=e.onFinish;e.node=this,e.onFinish=function(){this.destroy(),t&&t()};var r=new Konva.Tween(e);r.play()},Konva.Easings={BackEaseIn:function(e,t,r,i){var n=1.70158;return r*(e/=i)*e*((n+1)*e-n)+t},BackEaseOut:function(e,t,r,i){var n=1.70158;return r*((e=e/i-1)*e*((n+1)*e+n)+1)+t},BackEaseInOut:function(e,t,r,i){var n=1.70158;return(e/=i/2)<1?r/2*(e*e*(((n*=1.525)+1)*e-n))+t:r/2*((e-=2)*e*(((n*=1.525)+1)*e+n)+2)+t},ElasticEaseIn:function(e,t,r,i,n,s){var a=0;return 0===e?t:1===(e/=i)?t+r:(s||(s=.3*i),!n||n<Math.abs(r)?(n=r,a=s/4):a=s/(2*Math.PI)*Math.asin(r/n),-(n*Math.pow(2,10*(e-=1))*Math.sin((e*i-a)*(2*Math.PI)/s))+t)},ElasticEaseOut:function(e,t,r,i,n,s){var a=0;return 0===e?t:1===(e/=i)?t+r:(s||(s=.3*i),!n||n<Math.abs(r)?(n=r,a=s/4):a=s/(2*Math.PI)*Math.asin(r/n),n*Math.pow(2,-10*e)*Math.sin((e*i-a)*(2*Math.PI)/s)+r+t)},ElasticEaseInOut:function(e,t,r,i,n,s){var a=0;return 0===e?t:2===(e/=i/2)?t+r:(s||(s=i*(.3*1.5)),!n||n<Math.abs(r)?(n=r,a=s/4):a=s/(2*Math.PI)*Math.asin(r/n),1>e?-.5*(n*Math.pow(2,10*(e-=1))*Math.sin((e*i-a)*(2*Math.PI)/s))+t:n*Math.pow(2,-10*(e-=1))*Math.sin((e*i-a)*(2*Math.PI)/s)*.5+r+t)},BounceEaseOut:function(e,t,r,i){return(e/=i)<1/2.75?r*(7.5625*e*e)+t:2/2.75>e?r*(7.5625*(e-=1.5/2.75)*e+.75)+t:2.5/2.75>e?r*(7.5625*(e-=2.25/2.75)*e+.9375)+t:r*(7.5625*(e-=2.625/2.75)*e+.984375)+t},BounceEaseIn:function(e,t,r,i){return r-Konva.Easings.BounceEaseOut(i-e,0,r,i)+t},BounceEaseInOut:function(e,t,r,i){return i/2>e?.5*Konva.Easings.BounceEaseIn(2*e,0,r,i)+t:.5*Konva.Easings.BounceEaseOut(2*e-i,0,r,i)+.5*r+t},EaseIn:function(e,t,r,i){return r*(e/=i)*e+t},EaseOut:function(e,t,r,i){return-r*(e/=i)*(e-2)+t},EaseInOut:function(e,t,r,i){return(e/=i/2)<1?r/2*e*e+t:-r/2*(--e*(e-2)-1)+t},StrongEaseIn:function(e,t,r,i){return r*(e/=i)*e*e*e*e+t},StrongEaseOut:function(e,t,r,i){return r*((e=e/i-1)*e*e*e*e+1)+t},StrongEaseInOut:function(e,t,r,i){return(e/=i/2)<1?r/2*e*e*e*e*e+t:r/2*((e-=2)*e*e*e*e+2)+t},Linear:function(e,t,r,i){return r*e/i+t}}}();
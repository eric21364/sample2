!function(){"use strict";function H(e,t){e.content.addEventListener(t,function(r){e[M+t](r)},!1)}var e="Stage",t="string",r="px",i="mouseout",n="mouseleave",s="mouseover",a="mouseenter",o="mousemove",h="mousedown",c="mouseup",u="contextmenu",l="click",f="dblclick",p="touchstart",d="touchend",v="tap",g="dbltap",m="touchmove",y="DOMMouseScroll",b="mousewheel",x="wheel",w="contentMouseout",S="contentMouseover",_="contentMousemove",k="contentMousedown",C="contentMouseup",E="contentContextmenu",T="contentClick",A="contentDblclick",K="contentTouchstart",P="contentTouchend",F="contentDbltap",D="contentTap",N="contentTouchmove",B="contentWheel",I="div",L="relative",O="konvajs-content",R=" ",M="_",q="container",j="",U=[h,o,c,i,p,m,d,s,y,b,x,u],G=U.length;Konva.Stage=function(e){this.___init(e)},Konva.Util.addMethods(Konva.Stage,{___init:function(t){this.nodeType=e,Konva.Container.call(this,t),this._id=Konva.idCounter++,this._buildDOM(),this._bindContentEvents(),this._enableNestedTransforms=!1,Konva.stages.push(this)},_validateAdd:function(e){"Layer"!==e.getType()&&Konva.Util["throw"]("You may only add layers to the stage.")},setContainer:function(e){if(typeof e===t){if("."===e.charAt(0)){var r=e.slice(1);e=Konva.document.getElementsByClassName(r)[0]}else{var i;i="#"!==e.charAt(0)?e:e.slice(1),e=Konva.document.getElementById(i)}if(!e)throw"Can not find container in document with id "+i}return this._setAttr(q,e),this},shouldDrawHit:function(){return!0},draw:function(){return Konva.Node.prototype.draw.call(this),this},setHeight:function(e){return Konva.Node.prototype.setHeight.call(this,e),this._resizeDOM(),this},setWidth:function(e){return Konva.Node.prototype.setWidth.call(this,e),this._resizeDOM(),this},clear:function(){var r,e=this.children,t=e.length;for(r=0;t>r;r++)e[r].clear();return this},clone:function(e){return e||(e={}),e.container=Konva.document.createElement(I),Konva.Container.prototype.clone.call(this,e)},destroy:function(){var e=this.content;Konva.Container.prototype.destroy.call(this),e&&Konva.Util._isInDocument(e)&&this.getContainer().removeChild(e);var t=Konva.stages.indexOf(this);return t>-1&&Konva.stages.splice(t,1),this},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(e){e=e||{};var t=e.mimeType||null,r=e.quality||null,i=e.x||0,n=e.y||0,s=new Konva.SceneCanvas({width:e.width||this.getWidth(),height:e.height||this.getHeight(),pixelRatio:e.pixelRatio}),a=s.getContext()._context,o=this.children;(i||n)&&a.translate(-1*i,-1*n),o.each(function(e){var t=e.getCanvas().getWidth(),r=e.getCanvas().getHeight(),i=e.getCanvas().getPixelRatio();a.drawImage(e.getCanvas()._canvas,0,0,t/i,r/i)});var h=s.toDataURL(t,r);return e.callback&&e.callback(h),h},toImage:function(e){var t=e.callback;e.callback=function(e){Konva.Util._getImage(e,function(e){t(e)})},this.toDataURL(e)},getIntersection:function(e,t){var s,a,r=this.getChildren(),i=r.length,n=i-1;for(s=n;s>=0;s--)if(a=r[s].getIntersection(e,t))return a;return null},_resizeDOM:function(){if(this.content){var s,a,e=this.getWidth(),t=this.getHeight(),i=this.getChildren(),n=i.length;for(this.content.style.width=e+r,this.content.style.height=t+r,this.bufferCanvas.setSize(e,t),this.bufferHitCanvas.setSize(e,t),s=0;n>s;s++)a=i[s],a.setSize(e,t),a.batchDraw()}},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return Konva.Container.prototype.add.call(this,e),e._setCanvasSize(this.width(),this.height()),e.draw(),this.content.appendChild(e.canvas._canvas),this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){for(var e=0;G>e;e++)H(this,U[e])},_mouseover:function(e){Konva.UA.mobile||(this._setPointerPosition(e),this._fire(S,{evt:e}))},_mouseout:function(e){if(!Konva.UA.mobile){this._setPointerPosition(e);var t=this.targetShape;t&&!Konva.isDragging()&&(t._fireAndBubble(i,{evt:e}),t._fireAndBubble(n,{evt:e}),this.targetShape=null),this.pointerPos=void 0,this._fire(w,{evt:e})}},_mousemove:function(e){if(Konva.UA.ieMobile)return this._touchmove(e);if(("undefined"!=typeof e.movementX||"undefined"!=typeof e.movementY)&&0===e.movementY&&0===e.movementX)return null;if(Konva.UA.mobile)return null;this._setPointerPosition(e);var t;Konva.isDragging()||(t=this.getIntersection(this.getPointerPosition()),t&&t.isListening()?Konva.isDragging()||this.targetShape&&this.targetShape._id===t._id?t._fireAndBubble(o,{evt:e}):(this.targetShape&&(this.targetShape._fireAndBubble(i,{evt:e},t),this.targetShape._fireAndBubble(n,{evt:e},t)),t._fireAndBubble(s,{evt:e},this.targetShape),t._fireAndBubble(a,{evt:e},this.targetShape),this.targetShape=t):this.targetShape&&!Konva.isDragging()&&(this.targetShape._fireAndBubble(i,{evt:e}),this.targetShape._fireAndBubble(n,{evt:e}),this.targetShape=null),this._fire(_,{evt:e})),e.preventDefault&&e.preventDefault()},_mousedown:function(e){if(Konva.UA.ieMobile)return this._touchstart(e);if(!Konva.UA.mobile){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition());Konva.listenClickTap=!0,t&&t.isListening()&&(this.clickStartShape=t,t._fireAndBubble(h,{evt:e})),this._fire(k,{evt:e})}e.preventDefault&&e.preventDefault()},_mouseup:function(e){if(Konva.UA.ieMobile)return this._touchend(e);if(!Konva.UA.mobile){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition()),r=this.clickStartShape,i=!1,n=Konva.DD;Konva.inDblClickWindow?(i=!0,Konva.inDblClickWindow=!1):n&&n.justDragged?n&&(n.justDragged=!1):Konva.inDblClickWindow=!0,setTimeout(function(){Konva.inDblClickWindow=!1},Konva.dblClickWindow),t&&t.isListening()&&(t._fireAndBubble(c,{evt:e}),Konva.listenClickTap&&r&&r._id===t._id&&(t._fireAndBubble(l,{evt:e}),i&&t._fireAndBubble(f,{evt:e}))),this._fire(C,{evt:e}),Konva.listenClickTap&&(this._fire(T,{evt:e}),i&&this._fire(A,{evt:e})),Konva.listenClickTap=!1}e.preventDefault&&e.preventDefault()},_contextmenu:function(e){this._fire(E,{evt:e})},_touchstart:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition());Konva.listenClickTap=!0,t&&t.isListening()&&(this.tapStartShape=t,t._fireAndBubble(p,{evt:e}),t.isListening()&&t.preventDefault()&&e.preventDefault&&e.preventDefault()),this._fire(K,{evt:e})},_touchend:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition()),r=!1;Konva.inDblClickWindow?(r=!0,Konva.inDblClickWindow=!1):Konva.inDblClickWindow=!0,setTimeout(function(){Konva.inDblClickWindow=!1},Konva.dblClickWindow),t&&t.isListening()&&(t._fireAndBubble(d,{evt:e}),Konva.listenClickTap&&this.tapStartShape&&t._id===this.tapStartShape._id&&(t._fireAndBubble(v,{evt:e}),r&&t._fireAndBubble(g,{evt:e})),t.isListening()&&t.preventDefault()&&e.preventDefault&&e.preventDefault()),this._fire(P,{evt:e}),Konva.listenClickTap&&(this._fire(D,{evt:e}),r&&this._fire(F,{evt:e})),Konva.listenClickTap=!1},_touchmove:function(e){this._setPointerPosition(e);var r,t=Konva.DD;Konva.isDragging()||(r=this.getIntersection(this.getPointerPosition()),r&&r.isListening()&&(r._fireAndBubble(m,{evt:e}),r.isListening()&&r.preventDefault()&&e.preventDefault&&e.preventDefault()),this._fire(N,{evt:e})),t&&Konva.isDragging()&&Konva.DD.node.preventDefault()&&e.preventDefault()},_DOMMouseScroll:function(e){this._mousewheel(e)},_mousewheel:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition());t&&t.isListening()&&t._fireAndBubble(x,{evt:e}),this._fire(B,{evt:e})},_wheel:function(e){this._mousewheel(e)},_setPointerPosition:function(e){var t=this._getContentPosition(),r=null,i=null;if(e=e?e:window.event,void 0!==e.touches){if(e.touches.length>0){var n=e.touches[0];r=n.clientX-t.left,i=n.clientY-t.top}}else r=e.clientX-t.left,i=e.clientY-t.top;null!==r&&null!==i&&(this.pointerPos={x:r,y:i})},_getContentPosition:function(){var e=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:e.top,left:e.left}},_buildDOM:function(){var e=this.getContainer();if(!e){if(Konva.Util.isBrowser())throw"Stage has no container. A container is required.";e=Konva.document.createElement(I)}e.innerHTML=j,this.content=Konva.document.createElement(I),this.content.style.position=L,this.content.className=O,this.content.setAttribute("role","presentation"),e.appendChild(this.content),this.bufferCanvas=new Konva.SceneCanvas,this.bufferHitCanvas=new Konva.HitCanvas({pixelRatio:1}),this._resizeDOM()},_onContent:function(e,t){var n,s,r=e.split(R),i=r.length;for(n=0;i>n;n++)s=r[n],this.content.addEventListener(s,t,!1)},cache:function(){Konva.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.")},clearCache:function(){}}),Konva.Util.extend(Konva.Stage,Konva.Container),Konva.Factory.addGetter(Konva.Stage,"container"),Konva.Factory.addOverloadedGetterSetter(Konva.Stage,"container")}();
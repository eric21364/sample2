"use strict";function isScope(t){return"FunctionExpression"===t.type||"FunctionDeclaration"===t.type||"ArrowFunctionExpression"===t.type||"Program"===t.type}function isBlockScope(t){return"BlockStatement"===t.type||isScope(t)}function declaresArguments(t){return"FunctionExpression"===t.type||"FunctionDeclaration"===t.type}function declaresThis(t){return"FunctionExpression"===t.type||"FunctionDeclaration"===t.type}function reallyParse(t){try{return acorn.parse(t,{ecmaVersion:6,allowReturnOutsideFunction:!0,allowImportExportEverywhere:!0,allowHashBang:!0})}catch(e){return acorn.parse(t,{ecmaVersion:5,allowReturnOutsideFunction:!0,allowImportExportEverywhere:!0,allowHashBang:!0})}}function findGlobals(t){function o(t,n){var a=t.name;if("undefined"!==a){for(var i=0;i<n.length;i++){if("arguments"===a&&declaresArguments(n[i]))return;if(n[i].locals&&a in n[i].locals)return}n[n.length-2]&&"TryStatement"===n[n.length-2].type&&n[n.length-2].handler&&t===n[n.length-2].handler.param||(t.parents=n,e.push(t))}}var n,e=[];if(n="string"==typeof t?reallyParse(t):t,!n||"object"!=typeof n||"Program"!==n.type)throw new TypeError("Source must be either a string of JavaScript or an acorn AST");var a=function(t){var e=t;e.locals=e.locals||{},t.params.forEach(function(t){i(t,e)}),t.id&&(e.locals[t.id.name]=!0)},i=function(t,e){switch(t.type){case"Identifier":e.locals[t.name]=!0;break;case"ObjectPattern":t.properties.forEach(function(t){i(t.value,e)});break;case"ArrayPattern":t.elements.forEach(function(t){t&&i(t,e)});break;case"RestElement":i(t.argument,e);break;case"AssignmentPattern":i(t.left,e);break;default:throw new Error("Unrecognized pattern type: "+t.type)}},r=function(t,e){n.locals=n.locals||{},n.locals[t.local.name]=!0};walk.ancestor(n,{VariableDeclaration:function(t,e){for(var n=null,a=e.length-1;a>=0&&null===n;a--)("var"===t.kind?isScope(e[a]):isBlockScope(e[a]))&&(n=e[a]);n.locals=n.locals||{},t.declarations.forEach(function(t){i(t.id,n)})},FunctionDeclaration:function(t,e){for(var n=null,i=e.length-2;i>=0&&null===n;i--)isScope(e[i])&&(n=e[i]);n.locals=n.locals||{},n.locals[t.id.name]=!0,a(t)},Function:a,ClassDeclaration:function(t,e){for(var n=null,a=e.length-2;a>=0&&null===n;a--)isScope(e[a])&&(n=e[a]);n.locals=n.locals||{},n.locals[t.id.name]=!0},TryStatement:function(t){null!==t.handler&&(t.handler.body.locals=t.handler.body.locals||{},t.handler.body.locals[t.handler.param.name]=!0)},ImportDefaultSpecifier:r,ImportSpecifier:r,ImportNamespaceSpecifier:r}),walk.ancestor(n,{VariablePattern:o,Identifier:o,ThisExpression:function(t,n){for(var a=0;a<n.length;a++)if(declaresThis(n[a]))return;t.parents=n,e.push(t)}});var s={};return e.forEach(function(t){s[t.name]=s[t.name]||[],s[t.name].push(t)}),Object.keys(s).sort().map(function(t){return{name:t,nodes:s[t]}})}var acorn=require("acorn"),walk=require("acorn/dist/walk");module.exports=findGlobals,module.exports.parse=reallyParse;
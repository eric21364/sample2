function Adapter(t){this.nsp=t,this.rooms={},this.sids={},this.encoder=new parser.Encoder}function Room(){return this instanceof Room?(this.sockets={},void(this.length=0)):new Room}var Emitter=require("events").EventEmitter,parser=require("socket.io-parser");module.exports=Adapter,Adapter.prototype.__proto__=Emitter.prototype,Adapter.prototype.add=function(t,e,r){this.sids[t]=this.sids[t]||{},this.sids[t][e]=!0,this.rooms[e]=this.rooms[e]||Room(),this.rooms[e].add(t),r&&process.nextTick(r.bind(null,null))},Adapter.prototype.del=function(t,e,r){this.sids[t]=this.sids[t]||{},delete this.sids[t][e],this.rooms.hasOwnProperty(e)&&(this.rooms[e].del(t),0===this.rooms[e].length&&delete this.rooms[e]),r&&process.nextTick(r.bind(null,null))},Adapter.prototype.delAll=function(t,e){var r=this.sids[t];if(r)for(var n in r)this.rooms.hasOwnProperty(n)&&(this.rooms[n].del(t),0===this.rooms[n].length&&delete this.rooms[n]);delete this.sids[t],e&&process.nextTick(e.bind(null,null))},Adapter.prototype.broadcast=function(t,e){var h,r=e.rooms||[],n=e.except||[],i=e.flags||{},a={preEncoded:!0,"volatile":i["volatile"],compress:i.compress},s={},o=this;t.nsp=this.nsp.name,this.encoder.encode(t,function(t){if(r.length)for(var e=0;e<r.length;e++){var i=o.rooms[r[e]];if(i){var u=i.sockets;for(var c in u)if(u.hasOwnProperty(c)){if(s[c]||~n.indexOf(c))continue;h=o.nsp.connected[c],h&&(h.packet(t,a),s[c]=!0)}}}else for(var c in o.sids)if(o.sids.hasOwnProperty(c)){if(~n.indexOf(c))continue;h=o.nsp.connected[c],h&&h.packet(t,a)}})},Adapter.prototype.clients=function(t,e){"function"==typeof t&&(e=t,t=null),t=t||[];var a,r={},n=this,i=[];if(t.length)for(var s=0;s<t.length;s++){var o=n.rooms[t[s]];if(o){var h=o.sockets;for(var u in h)if(h.hasOwnProperty(u)){if(r[u])continue;a=n.nsp.connected[u],a&&(i.push(u),r[u]=!0)}}}else for(var u in n.sids)n.sids.hasOwnProperty(u)&&(a=n.nsp.connected[u],a&&i.push(u));e&&process.nextTick(e.bind(null,null,i))},Adapter.prototype.clientRooms=function(t,e){var r=this.sids[t];e&&process.nextTick(e.bind(null,null,r?Object.keys(r):null))},Room.prototype.add=function(t){this.sockets.hasOwnProperty(t)||(this.sockets[t]=!0,this.length++)},Room.prototype.del=function(t){this.sockets.hasOwnProperty(t)&&(delete this.sockets[t],this.length--)};
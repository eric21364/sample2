"use strict";function DBCSCodec(e,t){if(this.encodingName=e.encodingName,!e)throw new Error("DBCS codec is called without the data.");if(!e.table)throw new Error("Encoding '"+this.encodingName+"' has no data.");var r=e.table();this.decodeTables=[],this.decodeTables[0]=UNASSIGNED_NODE.slice(0),this.decodeTableSeq=[];for(var i=0;i<r.length;i++)this._addDecodeChunk(r[i]);this.defaultCharUnicode=t.defaultCharUnicode,this.encodeTable=[],this.encodeTableSeq=[];var n={};if(e.encodeSkipVals)for(var i=0;i<e.encodeSkipVals.length;i++){var s=e.encodeSkipVals[i];if("number"==typeof s)n[s]=!0;else for(var a=s.from;a<=s.to;a++)n[a]=!0}if(this._fillEncodeTable(0,0,n),e.encodeAdd)for(var o in e.encodeAdd)Object.prototype.hasOwnProperty.call(e.encodeAdd,o)&&this._setEncodeChar(o.charCodeAt(0),e.encodeAdd[o]);if(this.defCharSB=this.encodeTable[0][t.defaultCharSingleByte.charCodeAt(0)],this.defCharSB===UNASSIGNED&&(this.defCharSB=this.encodeTable[0]["?"]),this.defCharSB===UNASSIGNED&&(this.defCharSB="?".charCodeAt(0)),"function"==typeof e.gb18030){this.gb18030=e.gb18030();for(var u=this.decodeTables.length,h=this.decodeTables[u]=UNASSIGNED_NODE.slice(0),c=this.decodeTables.length,l=this.decodeTables[c]=UNASSIGNED_NODE.slice(0),i=129;254>=i;i++)for(var f=NODE_START-this.decodeTables[0][i],p=this.decodeTables[f],a=48;57>=a;a++)p[a]=NODE_START-u;for(var i=129;254>=i;i++)h[i]=NODE_START-c;for(var i=48;57>=i;i++)l[i]=GB18030_CODE}}function DBCSEncoder(e,t){this.leadSurrogate=-1,this.seqObj=void 0,this.encodeTable=t.encodeTable,this.encodeTableSeq=t.encodeTableSeq,this.defaultCharSingleByte=t.defCharSB,this.gb18030=t.gb18030}function DBCSDecoder(e,t){this.nodeIdx=0,this.prevBuf=new Buffer(0),this.decodeTables=t.decodeTables,this.decodeTableSeq=t.decodeTableSeq,this.defaultCharUnicode=t.defaultCharUnicode,this.gb18030=t.gb18030}function findIdx(e,t){if(e[0]>t)return-1;for(var r=0,i=e.length;i-1>r;){var n=r+Math.floor((i-r+1)/2);e[n]<=t?r=n:i=n}return r}exports._dbcs=DBCSCodec;for(var UNASSIGNED=-1,GB18030_CODE=-2,SEQ_START=-10,NODE_START=-1e3,UNASSIGNED_NODE=new Array(256),DEF_CHAR=-1,i=0;256>i;i++)UNASSIGNED_NODE[i]=UNASSIGNED;DBCSCodec.prototype.encoder=DBCSEncoder,DBCSCodec.prototype.decoder=DBCSDecoder,DBCSCodec.prototype._getDecodeTrieNode=function(e){for(var t=[];e>0;e>>=8)t.push(255&e);0==t.length&&t.push(0);for(var r=this.decodeTables[0],i=t.length-1;i>0;i--){var n=r[t[i]];if(n==UNASSIGNED)r[t[i]]=NODE_START-this.decodeTables.length,this.decodeTables.push(r=UNASSIGNED_NODE.slice(0));else{if(!(NODE_START>=n))throw new Error("Overwrite byte in "+this.encodingName+", addr: "+e.toString(16));r=this.decodeTables[NODE_START-n]}}return r},DBCSCodec.prototype._addDecodeChunk=function(e){var t=parseInt(e[0],16),r=this._getDecodeTrieNode(t);t=255&t;for(var i=1;i<e.length;i++){var n=e[i];if("string"==typeof n)for(var s=0;s<n.length;){var a=n.charCodeAt(s++);if(a>=55296&&56320>a){var o=n.charCodeAt(s++);if(!(o>=56320&&57344>o))throw new Error("Incorrect surrogate pair in "+this.encodingName+" at chunk "+e[0]);r[t++]=65536+1024*(a-55296)+(o-56320)}else if(a>4080&&4095>=a){for(var u=4095-a+2,h=[],c=0;u>c;c++)h.push(n.charCodeAt(s++));r[t++]=SEQ_START-this.decodeTableSeq.length,this.decodeTableSeq.push(h)}else r[t++]=a}else{if("number"!=typeof n)throw new Error("Incorrect type '"+typeof n+"' given in "+this.encodingName+" at chunk "+e[0]);for(var l=r[t-1]+1,s=0;n>s;s++)r[t++]=l++}}if(t>255)throw new Error("Incorrect chunk in "+this.encodingName+" at addr "+e[0]+": too long"+t)},DBCSCodec.prototype._getEncodeBucket=function(e){var t=e>>8;return void 0===this.encodeTable[t]&&(this.encodeTable[t]=UNASSIGNED_NODE.slice(0)),this.encodeTable[t]},DBCSCodec.prototype._setEncodeChar=function(e,t){var r=this._getEncodeBucket(e),i=255&e;r[i]<=SEQ_START?this.encodeTableSeq[SEQ_START-r[i]][DEF_CHAR]=t:r[i]==UNASSIGNED&&(r[i]=t)},DBCSCodec.prototype._setEncodeSequence=function(e,t){var s,r=e[0],i=this._getEncodeBucket(r),n=255&r;i[n]<=SEQ_START?s=this.encodeTableSeq[SEQ_START-i[n]]:(s={},i[n]!==UNASSIGNED&&(s[DEF_CHAR]=i[n]),i[n]=SEQ_START-this.encodeTableSeq.length,this.encodeTableSeq.push(s));for(var a=1;a<e.length-1;a++){var o=s[r];"object"==typeof o?s=o:(s=s[r]={},void 0!==o&&(s[DEF_CHAR]=o))}r=e[e.length-1],s[r]=t},DBCSCodec.prototype._fillEncodeTable=function(e,t,r){for(var i=this.decodeTables[e],n=0;256>n;n++){var s=i[n],a=t+n;r[a]||(s>=0?this._setEncodeChar(s,a):NODE_START>=s?this._fillEncodeTable(NODE_START-s,a<<8,r):SEQ_START>=s&&this._setEncodeSequence(this.decodeTableSeq[SEQ_START-s],a))}},DBCSEncoder.prototype.write=function(e){for(var t=new Buffer(e.length*(this.gb18030?4:3)),r=this.leadSurrogate,i=this.seqObj,n=-1,s=0,a=0;;){if(-1===n){if(s==e.length)break;var o=e.charCodeAt(s++)}else{var o=n;n=-1}if(o>=55296&&57344>o)if(56320>o){if(-1===r){r=o;continue}r=o,o=UNASSIGNED}else-1!==r?(o=65536+1024*(r-55296)+(o-56320),r=-1):o=UNASSIGNED;else-1!==r&&(n=o,o=UNASSIGNED,r=-1);var u=UNASSIGNED;if(void 0!==i&&o!=UNASSIGNED){var h=i[o];if("object"==typeof h){i=h;continue}"number"==typeof h?u=h:void 0==h&&(h=i[DEF_CHAR],void 0!==h&&(u=h,n=o)),i=void 0}else if(o>=0){var c=this.encodeTable[o>>8];if(void 0!==c&&(u=c[255&o]),SEQ_START>=u){i=this.encodeTableSeq[SEQ_START-u];continue}if(u==UNASSIGNED&&this.gb18030){var l=findIdx(this.gb18030.uChars,o);if(-1!=l){var u=this.gb18030.gbChars[l]+(o-this.gb18030.uChars[l]);t[a++]=129+Math.floor(u/12600),u%=12600,t[a++]=48+Math.floor(u/1260),u%=1260,t[a++]=129+Math.floor(u/10),u%=10,t[a++]=48+u;continue}}}u===UNASSIGNED&&(u=this.defaultCharSingleByte),256>u?t[a++]=u:65536>u?(t[a++]=u>>8,t[a++]=255&u):(t[a++]=u>>16,t[a++]=u>>8&255,t[a++]=255&u)}return this.seqObj=i,this.leadSurrogate=r,t.slice(0,a)},DBCSEncoder.prototype.end=function(){if(-1!==this.leadSurrogate||void 0!==this.seqObj){var e=new Buffer(10),t=0;if(this.seqObj){var r=this.seqObj[DEF_CHAR];void 0!==r&&(256>r?e[t++]=r:(e[t++]=r>>8,e[t++]=255&r)),this.seqObj=void 0}return-1!==this.leadSurrogate&&(e[t++]=this.defaultCharSingleByte,this.leadSurrogate=-1),e.slice(0,t)}},DBCSEncoder.prototype.findIdx=findIdx,DBCSDecoder.prototype.write=function(e){var a,t=new Buffer(2*e.length),r=this.nodeIdx,i=this.prevBuf,n=this.prevBuf.length,s=-this.prevBuf.length;n>0&&(i=Buffer.concat([i,e.slice(0,10)]));for(var o=0,u=0;o<e.length;o++){var h=o>=0?e[o]:i[o+n],a=this.decodeTables[r][h];if(a>=0);else if(a===UNASSIGNED)o=s,a=this.defaultCharUnicode.charCodeAt(0);else if(a===GB18030_CODE){var c=s>=0?e.slice(s,o+1):i.slice(s+n,o+1+n),l=12600*(c[0]-129)+1260*(c[1]-48)+10*(c[2]-129)+(c[3]-48),f=findIdx(this.gb18030.gbChars,l);a=this.gb18030.uChars[f]+l-this.gb18030.gbChars[f]}else{if(NODE_START>=a){r=NODE_START-a;continue}if(!(SEQ_START>=a))throw new Error("iconv-lite internal error: invalid decoding table value "+a+" at "+r+"/"+h);for(var p=this.decodeTableSeq[SEQ_START-a],d=0;d<p.length-1;d++)a=p[d],t[u++]=255&a,t[u++]=a>>8;a=p[p.length-1]}if(a>65535){a-=65536;var v=55296+Math.floor(a/1024);t[u++]=255&v,t[u++]=v>>8,a=56320+a%1024}t[u++]=255&a,t[u++]=a>>8,r=0,s=o+1}return this.nodeIdx=r,this.prevBuf=s>=0?e.slice(s):i.slice(s+n),t.slice(0,u).toString("ucs2")},DBCSDecoder.prototype.end=function(){for(var e="";this.prevBuf.length>0;){e+=this.defaultCharUnicode;var t=this.prevBuf.slice(1);this.prevBuf=new Buffer(0),this.nodeIdx=0,t.length>0&&(e+=this.write(t))}return this.nodeIdx=0,e};
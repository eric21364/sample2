"use strict";function parseAccept(e){for(var t=splitMediaTypes(e),r=0,i=0;r<t.length;r++){var n=parseMediaType(t[r].trim(),r);n&&(t[i++]=n)}return t.length=i,t}function parseMediaType(e,t){var r=simpleMediaTypeRegExp.exec(e);if(!r)return null;var i=Object.create(null),n=1,s=r[2],a=r[1];if(r[3])for(var o=splitParameters(r[3]).map(splitKeyValuePair),c=0;c<o.length;c++){var u=o[c],h=u[0].toLowerCase(),l=u[1],f=l&&'"'===l[0]&&'"'===l[l.length-1]?l.substr(1,l.length-2):l;if("q"===h){n=parseFloat(f);break}i[h]=f}return{type:a,subtype:s,params:i,q:n,i:t}}function getMediaTypePriority(e,t,r){for(var i={o:-1,q:0,s:0},n=0;n<t.length;n++){var s=specify(e,t[n],r);s&&(i.s-s.s||i.q-s.q||i.o-s.o)<0&&(i=s)}return i}function specify(e,t,r){var i=parseMediaType(e),n=0;if(!i)return null;if(t.type.toLowerCase()==i.type.toLowerCase())n|=4;else if("*"!=t.type)return null;if(t.subtype.toLowerCase()==i.subtype.toLowerCase())n|=2;else if("*"!=t.subtype)return null;var s=Object.keys(t.params);if(s.length>0){if(!s.every(function(e){return"*"==t.params[e]||(t.params[e]||"").toLowerCase()==(i.params[e]||"").toLowerCase()}))return null;n|=1}return{i:r,o:t.i,q:t.q,s:n}}function preferredMediaTypes(e,t){var r=parseAccept(void 0===e?"*/*":e||"");if(!t)return r.filter(isQuality).sort(compareSpecs).map(getFullType);var i=t.map(function(e,t){return getMediaTypePriority(e,r,t)});return i.filter(isQuality).sort(compareSpecs).map(function(e){return t[i.indexOf(e)]})}function compareSpecs(e,t){return t.q-e.q||t.s-e.s||e.o-t.o||e.i-t.i||0}function getFullType(e){return e.type+"/"+e.subtype}function isQuality(e){return e.q>0}function quoteCount(e){for(var t=0,r=0;-1!==(r=e.indexOf('"',r));)t++,r++;return t}function splitKeyValuePair(e){var r,i,t=e.indexOf("=");return-1===t?r=e:(r=e.substr(0,t),i=e.substr(t+1)),[r,i]}function splitMediaTypes(e){for(var t=e.split(","),r=1,i=0;r<t.length;r++)quoteCount(t[i])%2==0?t[++i]=t[r]:t[i]+=","+t[r];return t.length=i+1,t}function splitParameters(e){for(var t=e.split(";"),r=1,i=0;r<t.length;r++)quoteCount(t[i])%2==0?t[++i]=t[r]:t[i]+=";"+t[r];t.length=i+1;for(var r=0;r<t.length;r++)t[r]=t[r].trim();return t}module.exports=preferredMediaTypes,module.exports.preferredMediaTypes=preferredMediaTypes;var simpleMediaTypeRegExp=/^\s*([^\s\/;]+)\/([^;\s]+)\s*(?:;(.*))?$/;
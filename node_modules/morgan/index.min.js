"use strict";function morgan(t,e){var n=t,r=e||{};t&&"object"==typeof t&&(r=t,n=r.format||"default",deprecate("morgan(options): use morgan("+("string"==typeof n?JSON.stringify(n):"format")+", options) instead")),void 0===n&&deprecate("undefined format: specify a format");var i=r.immediate,a=r.skip||!1,s="function"!=typeof n?getFormatFunction(n):n,o=r.buffer,h=r.stream||process.stdout;if(o){deprecate("buffer option");var l="number"!=typeof o?DEFAULT_BUFFER_DURATION:o;h=createBufferStream(h,l)}return function(t,e,n){function r(){if(a!==!1&&a(t,e))return void debug("skip request");var n=s(morgan,t,e);return null==n?void debug("skip line"):(debug("log request"),void h.write(n+"\n"))}t._startAt=void 0,t._startTime=void 0,t._remoteAddress=getip(t),e._startAt=void 0,e._startTime=void 0,recordStartTime.call(t),i?r():(onHeaders(e,recordStartTime),onFinished(e,r)),n()}}function clfdate(t){var e=t.getUTCDate(),n=t.getUTCHours(),r=t.getUTCMinutes(),i=t.getUTCSeconds(),a=t.getUTCFullYear(),s=CLF_MONTH[t.getUTCMonth()];return pad2(e)+"/"+s+"/"+a+":"+pad2(n)+":"+pad2(r)+":"+pad2(i)+" +0000"}function compile(t){if("string"!=typeof t)throw new TypeError("argument format must be a string");var e=t.replace(/"/g,'\\"'),n='  "use strict"\n  return "'+e.replace(/:([-\w]{2,})(?:\[([^\]]+)\])?/g,function(t,e,n){var r="req, res",i="tokens["+String(JSON.stringify(e))+"]";return void 0!==n&&(r+=", "+String(JSON.stringify(n))),'" +\n    ('+i+"("+r+') || "-") + "'})+'"';return new Function("tokens, req, res",n)}function createBufferStream(t,e){function i(){r=null,t.write(n.join("")),n.length=0}function a(t){null===r&&(r=setTimeout(i,e)),n.push(t)}var n=[],r=null;return{write:a}}function format(t,e){return morgan[t]=e,this}function getFormatFunction(t){var e=morgan[t]||t||morgan["default"];return"function"!=typeof e?compile(e):e}function getip(t){return t.ip||t._remoteAddress||t.connection&&t.connection.remoteAddress||void 0}function pad2(t){var e=String(t);return(1===e.length?"0":"")+e}function recordStartTime(){this._startAt=process.hrtime(),this._startTime=new Date}function token(t,e){return morgan[t]=e,this}module.exports=morgan,module.exports.compile=compile,module.exports.format=format,module.exports.token=token;var auth=require("basic-auth"),debug=require("debug")("morgan"),deprecate=require("depd")("morgan"),onFinished=require("on-finished"),onHeaders=require("on-headers"),CLF_MONTH=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],DEFAULT_BUFFER_DURATION=1e3;morgan.format("combined",':remote-addr - :remote-user [:date[clf]] ":method :url HTTP/:http-version" :status :res[content-length] ":referrer" ":user-agent"'),morgan.format("common",':remote-addr - :remote-user [:date[clf]] ":method :url HTTP/:http-version" :status :res[content-length]'),morgan.format("default",':remote-addr - :remote-user [:date] ":method :url HTTP/:http-version" :status :res[content-length] ":referrer" ":user-agent"'),deprecate.property(morgan,"default","default format: use combined format"),morgan.format("short",":remote-addr :remote-user :method :url HTTP/:http-version :status :res[content-length] - :response-time ms"),morgan.format("tiny",":method :url :status :res[content-length] - :response-time ms"),morgan.format("dev",function t(e,n,r){var i=r._header?r.statusCode:void 0,a=i>=500?31:i>=400?33:i>=300?36:i>=200?32:0,s=t[a];return s||(s=t[a]=compile("[0m:method :url ["+a+"m:status [0m:response-time ms - :res[content-length][0m")),s(e,n,r)}),morgan.token("url",function(t){return t.originalUrl||t.url}),morgan.token("method",function(t){return t.method}),morgan.token("response-time",function(t,e,n){if(t._startAt&&e._startAt){var r=1e3*(e._startAt[0]-t._startAt[0])+1e-6*(e._startAt[1]-t._startAt[1]);return r.toFixed(void 0===n?3:n)}}),morgan.token("date",function(t,e,n){var r=new Date;switch(n||"web"){case"clf":return clfdate(r);case"iso":return r.toISOString();case"web":return r.toUTCString()}}),morgan.token("status",function(t,e){return e._header?String(e.statusCode):void 0}),morgan.token("referrer",function(t){return t.headers.referer||t.headers.referrer}),morgan.token("remote-addr",getip),morgan.token("remote-user",function(t){var e=auth(t);return e?e.name:void 0}),morgan.token("http-version",function(t){return t.httpVersionMajor+"."+t.httpVersionMinor}),morgan.token("user-agent",function(t){return t.headers["user-agent"]}),morgan.token("req",function(t,e,n){var r=t.headers[n.toLowerCase()];return Array.isArray(r)?r.join(", "):r}),morgan.token("res",function(t,e,n){if(!e._header)return void 0;var r=e.getHeader(n);return Array.isArray(r)?r.join(", "):r});
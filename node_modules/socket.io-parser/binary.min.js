var isArray=require("isarray"),isBuf=require("./is-buffer");exports.deconstructPacket=function(t){function n(t){if(!t)return t;if(isBuf(t)){var r={_placeholder:!0,num:e.length};return e.push(t),r}if(isArray(t)){for(var i=new Array(t.length),a=0;a<t.length;a++)i[a]=n(t[a]);return i}if("object"==typeof t&&!(t instanceof Date)){var i={};for(var s in t)i[s]=n(t[s]);return i}return t}var e=[],r=t.data,i=t;return i.data=n(r),i.attachments=e.length,{packet:i,buffers:e}},exports.reconstructPacket=function(t,e){function n(t){if(t&&t._placeholder){var r=e[t.num];return r}if(isArray(t)){for(var i=0;i<t.length;i++)t[i]=n(t[i]);return t}if(t&&"object"==typeof t){for(var a in t)t[a]=n(t[a]);return t}return t}return t.data=n(t.data),t.attachments=void 0,t},exports.removeBlobs=function(t,e){function r(t,a,s){if(!t)return t;if(global.Blob&&t instanceof Blob||global.File&&t instanceof File){n++;var o=new FileReader;o.onload=function(){s?s[a]=this.result:i=this.result,--n||e(i)},o.readAsArrayBuffer(t)}else if(isArray(t))for(var h=0;h<t.length;h++)r(t[h],h,t);else if(t&&"object"==typeof t&&!isBuf(t))for(var u in t)r(t[u],u,t)}var n=0,i=t;r(i),n||e(i)};
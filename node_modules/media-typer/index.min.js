function format(t){if(!t||"object"!=typeof t)throw new TypeError("argument obj is required");var e=t.parameters,n=t.subtype,i=t.suffix,r=t.type;if(!r||!typeNameRegExp.test(r))throw new TypeError("invalid type");if(!n||!subtypeNameRegExp.test(n))throw new TypeError("invalid subtype");var a=r+"/"+n;if(i){if(!typeNameRegExp.test(i))throw new TypeError("invalid suffix");a+="+"+i}if(e&&"object"==typeof e)for(var s,o=Object.keys(e).sort(),h=0;h<o.length;h++){if(s=o[h],!tokenRegExp.test(s))throw new TypeError("invalid parameter name");a+="; "+s+"="+qstring(e[s])}return a}function parse(t){if(!t)throw new TypeError("argument string is required");if("object"==typeof t&&(t=getcontenttype(t)),"string"!=typeof t)throw new TypeError("argument string is required to be a string");var i,r,o,e=t.indexOf(";"),n=-1!==e?t.substr(0,e):t,a=splitType(n),s={};for(paramRegExp.lastIndex=e;r=paramRegExp.exec(t);){if(r.index!==e)throw new TypeError("invalid parameter format");e+=r[0].length,i=r[1].toLowerCase(),o=r[2],'"'===o[0]&&(o=o.substr(1,o.length-2).replace(qescRegExp,"$1")),s[i]=o}if(-1!==e&&e!==t.length)throw new TypeError("invalid parameter format");return a.parameters=s,a}function getcontenttype(t){return"function"==typeof t.getHeader?t.getHeader("content-type"):"object"==typeof t.headers?t.headers&&t.headers["content-type"]:void 0}function qstring(t){var e=String(t);if(tokenRegExp.test(e))return e;if(e.length>0&&!textRegExp.test(e))throw new TypeError("invalid parameter value");return'"'+e.replace(quoteRegExp,"\\$1")+'"'}function splitType(t){var e=typeRegExp.exec(t.toLowerCase());if(!e)throw new TypeError("invalid media type");var r,n=e[1],i=e[2],a=i.lastIndexOf("+");-1!==a&&(r=i.substr(a+1),i=i.substr(0,a));var s={type:n,subtype:i,suffix:r};return s}var paramRegExp=/; *([!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) *= *("(?:[ !\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u0020-\u007e])*"|[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) */g,textRegExp=/^[\u0020-\u007e\u0080-\u00ff]+$/,tokenRegExp=/^[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+$/,qescRegExp=/\\([\u0000-\u007f])/g,quoteRegExp=/([\\"])/g,subtypeNameRegExp=/^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/,typeNameRegExp=/^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/,typeRegExp=/^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;exports.format=format,exports.parse=parse;
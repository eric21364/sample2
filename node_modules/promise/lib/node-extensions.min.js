"use strict";var Promise=require("./core.js"),asap=require("asap");module.exports=Promise,Promise.denodeify=function(e,t){return t=t||1/0,function(){var r=this,i=Array.prototype.slice.call(arguments);return new Promise(function(n,s){for(;i.length&&i.length>t;)i.pop();i.push(function(e,t){e?s(e):n(t)});var a=e.apply(r,i);!a||"object"!=typeof a&&"function"!=typeof a||"function"!=typeof a.then||n(a)})}},Promise.nodeify=function(e){return function(){var t=Array.prototype.slice.call(arguments),r="function"==typeof t[t.length-1]?t.pop():null,i=this;try{return e.apply(this,arguments).nodeify(r,i)}catch(n){if(null===r||"undefined"==typeof r)return new Promise(function(e,t){t(n)});asap(function(){r.call(i,n)})}}},Promise.prototype.nodeify=function(e,t){return"function"!=typeof e?this:void this.then(function(r){asap(function(){e.call(t,null,r)})},function(r){asap(function(){e.call(t,r)})})};
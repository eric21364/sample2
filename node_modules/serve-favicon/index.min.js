"use strict";function favicon(t,e){var n,r=e||{},i=calcMaxAge(r.maxAge);if(!t)throw new TypeError("path to favicon.ico is required");if(Buffer.isBuffer(t))n=createIcon(copyBuffer(t),i);else{if("string"!=typeof t)throw new TypeError("path to favicon.ico must be string or buffer");t=resolveSync(t)}return function(e,r,a){return"/favicon.ico"!==parseUrl(e).pathname?void a():"GET"!==e.method&&"HEAD"!==e.method?(r.statusCode="OPTIONS"===e.method?200:405,r.setHeader("Allow","GET, HEAD, OPTIONS"),r.setHeader("Content-Length","0"),void r.end()):n?void send(e,r,n):void fs.readFile(t,function(t,s){return t?a(t):(n=createIcon(s,i),void send(e,r,n))})}}function calcMaxAge(t){var e="string"==typeof t?ms(t):t;return null!=e?Math.min(Math.max(0,e),ONE_YEAR_MS):ONE_YEAR_MS}function copyBuffer(t){var e=new Buffer(t.length);return t.copy(e),e}function createIcon(t,e){return{body:t,headers:{"Cache-Control":"public, max-age="+Math.floor(e/1e3),ETag:etag(t)}}}function createIsDirError(t){var e=new Error("EISDIR, illegal operation on directory '"+t+"'");return e.code="EISDIR",e.errno=28,e.path=t,e.syscall="open",e}function isFresh(t,e){return fresh(t.headers,{etag:e.getHeader("ETag"),"last-modified":e.getHeader("Last-Modified")})}function resolveSync(t){var e=resolve(t),r=fs.statSync(e);if(r.isDirectory())throw createIsDirError(e);return e}function send(t,e,r){for(var n=r.headers,i=Object.keys(n),a=0;a<i.length;a++){var s=i[a];e.setHeader(s,n[s])}return isFresh(t,e)?(e.statusCode=304,void e.end()):(e.statusCode=200,e.setHeader("Content-Length",r.body.length),e.setHeader("Content-Type","image/x-icon"),void e.end(r.body))}var etag=require("etag"),fresh=require("fresh"),fs=require("fs"),ms=require("ms"),parseUrl=require("parseurl"),path=require("path"),resolve=path.resolve;module.exports=favicon;var ONE_YEAR_MS=31536e6;
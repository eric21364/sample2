"use strict";function InternalCodec(e,t){this.enc=e.encodingName,this.bomAware=e.bomAware,"base64"===this.enc?this.encoder=InternalEncoderBase64:"cesu8"===this.enc&&(this.enc="utf8",this.encoder=InternalEncoderCesu8,3==new Buffer("eda080","hex").toString().length&&(this.decoder=InternalDecoderCesu8,this.defaultCharUnicode=t.defaultCharUnicode))}function InternalDecoder(e,t){StringDecoder.call(this,t.enc)}function InternalEncoder(e,t){this.enc=t.enc}function InternalEncoderBase64(e,t){this.prevStr=""}function InternalEncoderCesu8(e,t){}function InternalDecoderCesu8(e,t){this.acc=0,this.contBytes=0,this.accBytes=0,this.defaultCharUnicode=t.defaultCharUnicode}module.exports={utf8:{type:"_internal",bomAware:!0},cesu8:{type:"_internal",bomAware:!0},unicode11utf8:"utf8",ucs2:{type:"_internal",bomAware:!0},utf16le:"ucs2",binary:{type:"_internal"},base64:{type:"_internal"},hex:{type:"_internal"},_internal:InternalCodec},InternalCodec.prototype.encoder=InternalEncoder,InternalCodec.prototype.decoder=InternalDecoder;var StringDecoder=require("string_decoder").StringDecoder;StringDecoder.prototype.end||(StringDecoder.prototype.end=function(){}),InternalDecoder.prototype=StringDecoder.prototype,InternalEncoder.prototype.write=function(e){return new Buffer(e,this.enc)},InternalEncoder.prototype.end=function(){},InternalEncoderBase64.prototype.write=function(e){e=this.prevStr+e;var t=e.length-e.length%4;return this.prevStr=e.slice(t),e=e.slice(0,t),new Buffer(e,"base64")},InternalEncoderBase64.prototype.end=function(){return new Buffer(this.prevStr,"base64")},InternalEncoderCesu8.prototype.write=function(e){for(var t=new Buffer(3*e.length),r=0,i=0;i<e.length;i++){var n=e.charCodeAt(i);128>n?t[r++]=n:2048>n?(t[r++]=192+(n>>>6),t[r++]=128+(63&n)):(t[r++]=224+(n>>>12),t[r++]=128+(n>>>6&63),t[r++]=128+(63&n))}return t.slice(0,r)},InternalEncoderCesu8.prototype.end=function(){},InternalDecoderCesu8.prototype.write=function(e){for(var t=this.acc,r=this.contBytes,i=this.accBytes,n="",s=0;s<e.length;s++){var a=e[s];128!==(192&a)?(r>0&&(n+=this.defaultCharUnicode,r=0),128>a?n+=String.fromCharCode(a):224>a?(t=31&a,r=1,i=1):240>a?(t=15&a,r=2,i=1):n+=this.defaultCharUnicode):r>0?(t=t<<6|63&a,r--,i++,0===r&&(n+=2===i&&128>t&&t>0?this.defaultCharUnicode:3===i&&2048>t?this.defaultCharUnicode:String.fromCharCode(t))):n+=this.defaultCharUnicode}return this.acc=t,this.contBytes=r,this.accBytes=i,n},InternalDecoderCesu8.prototype.end=function(){var e=0;return this.contBytes>0&&(e+=this.defaultCharUnicode),e};
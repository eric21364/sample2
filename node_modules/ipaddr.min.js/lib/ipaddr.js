(function(){var e,t,r,i,n,s,a,o;t={},o=this,"undefined"!=typeof module&&null!==module&&module.exports?module.exports=t:o.ipaddr=t,a=function(e,t,r,i){var n,s;if(e.length!==t.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");for(n=0;i>0;){if(s=r-i,0>s&&(s=0),e[n]>>s!==t[n]>>s)return!1;i-=r,n+=1}return!0},t.subnetMatch=function(e,t,r){var i,n,s,a,o;null==r&&(r="unicast");for(i in t)for(n=t[i],!n[0]||n[0]instanceof Array||(n=[n]),a=0,o=n.length;o>a;a++)if(s=n[a],e.match.apply(e,s))return i;return r},t.IPv4=function(){function e(e){var t,r,i;if(4!==e.length)throw new Error("ipaddr: ipv4 octet count should be 4");for(r=0,i=e.length;i>r;r++)if(t=e[r],!(t>=0&&255>=t))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=e}return e.prototype.kind=function(){return"ipv4"},e.prototype.toString=function(){return this.octets.join(".")},e.prototype.toByteArray=function(){return this.octets.slice(0)},e.prototype.match=function(e,t){var r;if(void 0===t&&(r=e,e=r[0],t=r[1]),"ipv4"!==e.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return a(this.octets,e.octets,8,t)},e.prototype.SpecialRanges={unspecified:[[new e([0,0,0,0]),8]],broadcast:[[new e([255,255,255,255]),32]],multicast:[[new e([224,0,0,0]),4]],linkLocal:[[new e([169,254,0,0]),16]],loopback:[[new e([127,0,0,0]),8]],carrierGradeNat:[[new e([100,64,0,0]),10]],"private":[[new e([10,0,0,0]),8],[new e([172,16,0,0]),12],[new e([192,168,0,0]),16]],reserved:[[new e([192,0,0,0]),24],[new e([192,0,2,0]),24],[new e([192,88,99,0]),24],[new e([198,51,100,0]),24],[new e([203,0,113,0]),24],[new e([240,0,0,0]),4]]},e.prototype.range=function(){return t.subnetMatch(this,this.SpecialRanges)},e.prototype.toIPv4MappedAddress=function(){return t.IPv6.parse("::ffff:"+this.toString())},e.prototype.prefixLengthFromSubnetMask=function(){var e,t,r,i,n,s,a;for(s={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0},e=0,i=!1,t=a=3;a>=0;t=a+=-1){if(r=this.octets[t],!(r in s))return null;if(n=s[r],i&&0!==n)return null;8!==n&&(i=!0),e+=n}return 32-e},e}(),r="(0?\\d+|0x[a-f0-9]+)",i={fourOctet:new RegExp("^"+r+"\\."+r+"\\."+r+"\\."+r+"$","i"),longValue:new RegExp("^"+r+"$","i")},t.IPv4.parser=function(e){var t,r,n,s,a;if(r=function(e){return"0"===e[0]&&"x"!==e[1]?parseInt(e,8):parseInt(e)},t=e.match(i.fourOctet))return function(){var e,i,s,a;for(s=t.slice(1,6),a=[],e=0,i=s.length;i>e;e++)n=s[e],a.push(r(n));return a}();if(t=e.match(i.longValue)){if(a=r(t[1]),a>4294967295||0>a)throw new Error("ipaddr: address outside defined range");return function(){var e,t;for(t=[],s=e=0;24>=e;s=e+=8)t.push(a>>s&255);return t}().reverse()}return null},t.IPv6=function(){function e(e){var t,r,i,n,s,a;if(16===e.length)for(this.parts=[],t=i=0;14>=i;t=i+=2)this.parts.push(e[t]<<8|e[t+1]);else{if(8!==e.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=e}for(a=this.parts,n=0,s=a.length;s>n;n++)if(r=a[n],!(r>=0&&65535>=r))throw new Error("ipaddr: ipv6 part should fit in 16 bits")}return e.prototype.kind=function(){return"ipv6"},e.prototype.toString=function(){var e,t,r,i,n,s,a;for(n=function(){var e,r,i,n;for(i=this.parts,n=[],e=0,r=i.length;r>e;e++)t=i[e],n.push(t.toString(16));return n}.call(this),e=[],r=function(t){return e.push(t)},i=0,s=0,a=n.length;a>s;s++)switch(t=n[s],i){case 0:r("0"===t?"":t),i=1;break;case 1:"0"===t?i=2:r(t);break;case 2:"0"!==t&&(r(""),r(t),i=3);break;case 3:r(t)}return 2===i&&(r(""),r("")),e.join(":")},e.prototype.toByteArray=function(){var e,t,r,i,n;for(e=[],n=this.parts,r=0,i=n.length;i>r;r++)t=n[r],e.push(t>>8),e.push(255&t);return e},e.prototype.toNormalizedString=function(){var e;return function(){var t,r,i,n;for(i=this.parts,n=[],t=0,r=i.length;r>t;t++)e=i[t],n.push(e.toString(16));return n}.call(this).join(":")},e.prototype.match=function(e,t){var r;if(void 0===t&&(r=e,e=r[0],t=r[1]),"ipv6"!==e.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return a(this.parts,e.parts,16,t)},e.prototype.SpecialRanges={unspecified:[new e([0,0,0,0,0,0,0,0]),128],linkLocal:[new e([65152,0,0,0,0,0,0,0]),10],multicast:[new e([65280,0,0,0,0,0,0,0]),8],loopback:[new e([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new e([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new e([0,0,0,0,0,65535,0,0]),96],rfc6145:[new e([0,0,0,0,65535,0,0,0]),96],rfc6052:[new e([100,65435,0,0,0,0,0,0]),96],"6to4":[new e([8194,0,0,0,0,0,0,0]),16],teredo:[new e([8193,0,0,0,0,0,0,0]),32],reserved:[[new e([8193,3512,0,0,0,0,0,0]),32]]},e.prototype.range=function(){return t.subnetMatch(this,this.SpecialRanges)},e.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},e.prototype.toIPv4Address=function(){var e,r,i;if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");return i=this.parts.slice(-2),e=i[0],r=i[1],new t.IPv4([e>>8,255&e,r>>8,255&r])},e}(),n="(?:[0-9a-f]+::?)+",s={"native":new RegExp("^(::)?("+n+")?([0-9a-f]+)?(::)?$","i"),transitional:new RegExp("^((?:"+n+")|(?:::)(?:"+n+")?)"+(""+r+"\\."+r+"\\."+r+"\\."+r+"$"),"i")},e=function(e,t){var r,i,n,s,a;if(e.indexOf("::")!==e.lastIndexOf("::"))return null;for(r=0,i=-1;(i=e.indexOf(":",i+1))>=0;)r++;if("::"===e.substr(0,2)&&r--,"::"===e.substr(-2,2)&&r--,r>t)return null;for(a=t-r,s=":";a--;)s+="0:";return e=e.replace("::",s),":"===e[0]&&(e=e.slice(1)),":"===e[e.length-1]&&(e=e.slice(0,-1)),function(){var t,r,i,s;for(i=e.split(":"),s=[],t=0,r=i.length;r>t;t++)n=i[t],s.push(parseInt(n,16));return s}()},t.IPv6.parser=function(t){var r,i,n,a,o,u;if(t.match(s["native"]))return e(t,8);if((r=t.match(s.transitional))&&(a=e(r[1].slice(0,-1),6))){for(n=[parseInt(r[2]),parseInt(r[3]),parseInt(r[4]),parseInt(r[5])],o=0,u=n.length;u>o;o++)if(i=n[o],!(i>=0&&255>=i))return null;return a.push(n[0]<<8|n[1]),a.push(n[2]<<8|n[3]),a}return null},t.IPv4.isIPv4=t.IPv6.isIPv6=function(e){return null!==this.parser(e)},t.IPv4.isValid=function(e){var t;try{return new this(this.parser(e)),!0}catch(r){return t=r,!1}},t.IPv4.isValidFourPartDecimal=function(e){return t.IPv4.isValid(e)&&e.match(/^\d+(\.\d+){3}$/)?!0:!1},t.IPv6.isValid=function(e){var t;if("string"==typeof e&&-1===e.indexOf(":"))return!1;try{return new this(this.parser(e)),!0}catch(r){return t=r,!1}},t.IPv4.parse=t.IPv6.parse=function(e){var t;if(t=this.parser(e),null===t)throw new Error("ipaddr: string is not formatted like ip address");return new this(t)},t.IPv4.parseCIDR=function(e){var t,r;if((r=e.match(/^(.+)\/(\d+)$/))&&(t=parseInt(r[2]),t>=0&&32>=t))return[this.parse(r[1]),t];throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},t.IPv6.parseCIDR=function(e){var t,r;if((r=e.match(/^(.+)\/(\d+)$/))&&(t=parseInt(r[2]),t>=0&&128>=t))return[this.parse(r[1]),t];throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},t.isValid=function(e){return t.IPv6.isValid(e)||t.IPv4.isValid(e)},t.parse=function(e){if(t.IPv6.isValid(e))return t.IPv6.parse(e);if(t.IPv4.isValid(e))return t.IPv4.parse(e);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},t.parseCIDR=function(e){var r;try{return t.IPv6.parseCIDR(e)}catch(i){r=i;try{return t.IPv4.parseCIDR(e)}catch(i){throw r=i,new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},t.fromByteArray=function(e){var r;if(r=e.length,4===r)return new t.IPv4(e);if(16===r)return new t.IPv6(e);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},t.process=function(e){var t;return t=this.parse(e),"ipv6"===t.kind()&&t.isIPv4MappedAddress()?t.toIPv4Address():t}}).call(this);
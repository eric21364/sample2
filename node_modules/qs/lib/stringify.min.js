"use strict";var utils=require("./utils"),formats=require("./formats"),arrayPrefixGenerators={brackets:function(e){return e+"[]"},indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},toISO=Date.prototype.toISOString,defaults={delimiter:"&",encode:!0,encoder:utils.encode,encodeValuesOnly:!1,serializeDate:function(e){return toISO.call(e)},skipNulls:!1,strictNullHandling:!1},stringify=function n(e,t,r,i,s,a,o,u,c,h,l,f){var p=e;if("function"==typeof o)p=o(t,p);else if(p instanceof Date)p=h(p);else if(null===p){if(i)return a&&!f?a(t):t;p=""}if("string"==typeof p||"number"==typeof p||"boolean"==typeof p||utils.isBuffer(p)){if(a){var d=f?t:a(t);return[l(d)+"="+l(a(p))]}return[l(t)+"="+l(String(p))]}var v=[];if("undefined"==typeof p)return v;var g;if(Array.isArray(o))g=o;else{var m=Object.keys(p);g=u?m.sort(u):m}for(var y=0;y<g.length;++y){var b=g[y];s&&null===p[b]||(v=Array.isArray(p)?v.concat(n(p[b],r(t,b),r,i,s,a,o,u,c,h,l,f)):v.concat(n(p[b],t+(c?"."+b:"["+b+"]"),r,i,s,a,o,u,c,h,l,f)))}return v};module.exports=function(e,t){var r=e,i=t||{};if(null!==i.encoder&&void 0!==i.encoder&&"function"!=typeof i.encoder)throw new TypeError("Encoder has to be a function.");var n="undefined"==typeof i.delimiter?defaults.delimiter:i.delimiter,s="boolean"==typeof i.strictNullHandling?i.strictNullHandling:defaults.strictNullHandling,a="boolean"==typeof i.skipNulls?i.skipNulls:defaults.skipNulls,o="boolean"==typeof i.encode?i.encode:defaults.encode,u="function"==typeof i.encoder?i.encoder:defaults.encoder,c="function"==typeof i.sort?i.sort:null,h="undefined"==typeof i.allowDots?!1:i.allowDots,l="function"==typeof i.serializeDate?i.serializeDate:defaults.serializeDate,f="boolean"==typeof i.encodeValuesOnly?i.encodeValuesOnly:defaults.encodeValuesOnly;if("undefined"==typeof i.format)i.format=formats["default"];else if(!Object.prototype.hasOwnProperty.call(formats.formatters,i.format))throw new TypeError("Unknown format option provided.");var d,v,p=formats.formatters[i.format];"function"==typeof i.filter?(v=i.filter,r=v("",r)):Array.isArray(i.filter)&&(v=i.filter,d=v);var g=[];if("object"!=typeof r||null===r)return"";var m;m=i.arrayFormat in arrayPrefixGenerators?i.arrayFormat:"indices"in i?i.indices?"indices":"repeat":"indices";var y=arrayPrefixGenerators[m];d||(d=Object.keys(r)),c&&d.sort(c);for(var b=0;b<d.length;++b){var x=d[b];a&&null===r[x]||(g=g.concat(stringify(r[x],x,y,s,a,o?u:null,v,c,h,l,p,f)))}return g.join(n)};
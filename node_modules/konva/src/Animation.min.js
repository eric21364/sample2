!function(e){"use strict";function r(e){setTimeout(e,1e3/60)}function n(){return i.apply(e.global,arguments)}var t=function(){return e.global.performance&&e.global.performance.now?function(){return e.global.performance.now()}:function(){return(new Date).getTime()}}(),i=function(){return e.global.requestAnimationFrame||e.global.webkitRequestAnimationFrame||e.global.mozRequestAnimationFrame||e.global.oRequestAnimationFrame||e.global.msRequestAnimationFrame||r}();e.Animation=function(r,i){var n=e.Animation;this.func=r,this.setLayers(i),this.id=n.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:t()}},e.Animation.prototype={setLayers:function(e){var t=[];return t=e?e.length>0?e:[e]:[],this.layers=t,this},getLayers:function(){return this.layers},addLayer:function(e){var i,t=this.layers,r=t.length;for(i=0;r>i;i++)if(t[i]._id===e._id)return!1;return this.layers.push(e),!0},isRunning:function(){var n,t=e.Animation,r=t.animations,i=r.length;for(n=0;i>n;n++)if(r[n].id===this.id)return!0;return!1},start:function(){var r=e.Animation;return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=t(),r._addAnimation(this),this},stop:function(){return e.Animation._removeAnimation(this),this},_updateFrameObject:function(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},e.Animation.animations=[],e.Animation.animIdCounter=0,e.Animation.animRunning=!1,e.Animation._addAnimation=function(e){this.animations.push(e),this._handleAnimation()},e.Animation._removeAnimation=function(e){var n,t=e.id,r=this.animations,i=r.length;for(n=0;i>n;n++)if(r[n].id===t){this.animations.splice(n,1);break}},e.Animation._runFrames=function(){var i,n,s,a,o,u,c,h,l,e={},r=this.animations;for(a=0;a<r.length;a++)if(i=r[a],n=i.layers,s=i.func,i._updateFrameObject(t()),u=n.length,l=s?s.call(i,i.frame)!==!1:!0)for(o=0;u>o;o++)c=n[o],void 0!==c._id&&(e[c._id]=c);for(h in e)e.hasOwnProperty(h)&&e[h].draw()},e.Animation._animationLoop=function(){var t=e.Animation;t.animations.length?(t._runFrames(),n(t._animationLoop)):t.animRunning=!1},e.Animation._handleAnimation=function(){this.animRunning||(this.animRunning=!0,n(this._animationLoop))},e.BaseLayer.prototype.batchDraw=function(){var t=this,r=e.Animation;return this.batchAnim||(this.batchAnim=new r(function(){t.batchAnim.stop()},this)),this.batchAnim.isRunning()||this.batchAnim.start(),this},e.Stage.prototype.batchDraw=function(){return this.getChildren().each(function(e){e.batchDraw()}),this}}(Konva);
"use strict";function reallyParse(e){try{return acorn.parse(e,{ecmaVersion:5,allowReturnOutsideFunction:!0})}catch(t){if("SyntaxError"!==t.name)throw t;return acorn.parse(e,{ecmaVersion:6,allowReturnOutsideFunction:!0})}}function addWith(e,t,r){e+="",t+="",r=r||[],r=r.concat(detect(e).map(function(e){return e.name}));var n=detect(t).map(function(e){return e.name}).filter(function(e){return-1===r.indexOf(e)});if(0===n.length)return t;var i="",a="locals_for_with",s="result_of_with";if(/^[a-zA-Z0-9$_]+$/.test(e))a=e;else{for(;-1!=n.indexOf(a)||-1!=r.indexOf(a);)a+="_";i="var "+a+" = ("+e+")"}for(;-1!=n.indexOf(s)||-1!=r.indexOf(s);)s+="_";var o=n.map(function(e){return JSON.stringify(e)+" in "+a+"?"+a+"."+e+":typeof "+e+'!=="undefined"?'+e+":undefined"});return t="(function ("+n.join(", ")+") {"+t+"}.call(this"+o.map(function(e){return","+e}).join("")+"))",";"+i+";"+unwrapReturns(t,s)+";"}function unwrapReturns(e,t){function o(t){return e.slice(t.start,t.end).join("")}function h(t,r){for(var n=t.start;n<t.end;n++)e[n]="";e[t.start]=r}var a,r=e,n=!1,i=reallyParse(e);if(e=e.split(""),1!==(a=i.body).length||"ExpressionStatement"!==(a=a[0]).type||"CallExpression"!==(a=a.expression).type||"MemberExpression"!==(a=a.callee).type||a.computed!==!1||"call"!==a.property.name||"FunctionExpression"!==(a=a.object).type)throw new Error("AST does not seem to represent a self-calling function");var s=a;return walk.recursive(i,null,{Function:function(e,t,r){e===s&&r(e.body,t,"ScopeBody")},ReturnStatement:function(e){n=!0,h(e,"return {value: "+o(e.argument)+"};")}}),n?"var "+t+"="+e.join("")+";if ("+t+") return "+t+".value":r}var detect=require("acorn-globals"),acorn=require("acorn"),walk=require("acorn/dist/walk");walk.base.ExportNamedDeclaration=walk.base.ExportDefaultDeclaration=function(e,t,r){return r(e.declaration,t)},walk.base.ImportDefaultSpecifier=walk.base.ImportNamespaceSpecifier=function(){},module.exports=addWith;
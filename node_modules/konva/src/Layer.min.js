!function(){"use strict";var e="#",t="beforeDraw",r="draw",i=[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],n=i.length;Konva.Layer=function(e){this.____init(e)},Konva.Util.addMethods(Konva.Layer,{____init:function(e){this.nodeType="Layer",this.canvas=new Konva.SceneCanvas,this.hitCanvas=new Konva.HitCanvas({pixelRatio:1}),Konva.BaseLayer.call(this,e)},_setCanvasSize:function(e,t){this.canvas.setSize(e,t),this.hitCanvas.setSize(e,t)},_validateAdd:function(e){var t=e.getType();"Group"!==t&&"Shape"!==t&&Konva.Util["throw"]("You may only add groups and shapes to a layer.")},getIntersection:function(e,t){var r,s,a,o;if(!this.hitGraphEnabled()||!this.isVisible())return null;for(var u=1,c=!1;;){for(s=0;n>s;s++){if(a=i[s],r=this._getIntersection({x:e.x+a.x*u,y:e.y+a.y*u}),o=r.shape,o&&t)return o.findAncestor(t,!0);if(o)return o;if(c=!!r.antialiased,!r.antialiased)break}if(!c)return null;u+=1}},_getImageData:function(e,t){var r=this.hitCanvas.width||1,i=this.hitCanvas.height||1,n=Math.round(t)*r+Math.round(e);return this._hitImageData||(this._hitImageData=this.hitCanvas.context.getImageData(0,0,r,i)),[this._hitImageData.data[4*n+0],this._hitImageData.data[4*n+1],this._hitImageData.data[4*n+2],this._hitImageData.data[4*n+3]]},_getIntersection:function(t){var s,a,r=this.hitCanvas.pixelRatio,i=this.hitCanvas.context.getImageData(Math.round(t.x*r),Math.round(t.y*r),1,1).data,n=i[3];return 255===n?(s=Konva.Util._rgbToHex(i[0],i[1],i[2]),a=Konva.shapes[e+s],a?{shape:a}:{antialiased:!0}):n>0?{antialiased:!0}:{}},drawScene:function(e,i){var n=this.getLayer(),s=e||n&&n.getCanvas();return this._fire(t,{node:this}),this.getClearBeforeDraw()&&s.getContext().clear(),Konva.Container.prototype.drawScene.call(this,s,i),this._fire(r,{node:this}),this},drawHit:function(e,t){var r=this.getLayer(),i=e||r&&r.hitCanvas;return r&&r.getClearBeforeDraw()&&r.getHitCanvas().getContext().clear(),Konva.Container.prototype.drawHit.call(this,i,t),this.imageData=null,this},clear:function(e){return Konva.BaseLayer.prototype.clear.call(this,e),this.getHitCanvas().getContext().clear(e),this.imageData=null,this},setVisible:function(e){return Konva.Node.prototype.setVisible.call(this,e),e?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this},enableHitGraph:function(){return this.setHitGraphEnabled(!0),this},disableHitGraph:function(){return this.setHitGraphEnabled(!1),this},setSize:function(e,t){return Konva.BaseLayer.prototype.setSize.call(this,e,t),this.hitCanvas.setSize(e,t),this}}),Konva.Util.extend(Konva.Layer,Konva.BaseLayer),Konva.Factory.addGetterSetter(Konva.Layer,"hitGraphEnabled",!0),Konva.Collection.mapMethods(Konva.Layer)}();
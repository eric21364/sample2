function importOptionsFrom(e){return void 0===e?["all"]:e}function missingDirectory(e){return!fs.existsSync(e)&&!/\.css$/.test(e)}function presentDirectory(e){return fs.existsSync(e)&&fs.statSync(e).isDirectory()}function proxyOptionsFrom(e){return e?{hostname:url.parse(e).hostname,port:parseInt(url.parse(e).port)}:{}}function runMinifier(e,t){function r(r){return r=t.options.debug?minifyWithDebug(t,r):minify(t,r),r=withMetadata(t,r),e?e.call(null,t.errors.length>0?t.errors:null,r):r}return function(e){return t.options.sourceMap?t.inputSourceMapTracker.track(e,function(){return t.options.sourceMapInlineSources?t.inputSourceMapTracker.resolveSources(function(){return r(e)}):r(e)}):r(e)}}function withMetadata(e,t){return t.stats=e.stats,t.errors=e.errors,t.warnings=e.warnings,t}function minifyWithDebug(e,t){var r=process.hrtime();e.stats.originalSize=e.sourceTracker.removeAll(t).length,t=minify(e,t);var i=process.hrtime(r);return e.stats.timeSpent=~~(1e3*i[0]+i[1]/1e6),e.stats.efficiency=1-t.styles.length/e.stats.originalSize,e.stats.minifiedSize=t.styles.length,t}function benchmark(e){return function(t,r){var i=t.constructor.name+"#"+r,n=process.hrtime();e(t,r);var s=process.hrtime(n);console.log("%d ms: "+i,1e3*s[0]+s[1]/1e6)}}function minify(e,t){function u(t,o){return t=s.restore(t,o),t=a.restore(t),t=r.rebase?rebaseUrls(t,e):t,t=n.restore(t),i.restore(t)}var r=e.options,i=new CommentsProcessor(e,r.keepSpecialComments,r.keepBreaks,r.sourceMap),n=new ExpressionsProcessor(r.sourceMap),s=new FreeTextProcessor(r.sourceMap),a=new UrlsProcessor(e,r.sourceMap,r.compatibility.properties.urlQuotes),o=r.sourceMap?sourceMapStringify:simpleStringify,h=function(e,r){t="function"==typeof e?e(t):e[r](t)};r.benchmark&&(h=benchmark(h)),h(i,"escape"),h(n,"escape"),h(a,"escape"),h(s,"escape");var c=tokenize(t,e);return simpleOptimize(c,r,e),r.advanced&&advancedOptimize(c,r,e,!0),o(c,r,u,e.inputSourceMapTracker)}var ImportInliner=require("./imports/inliner"),rebaseUrls=require("./urls/rebase"),tokenize=require("./tokenizer/tokenize"),simpleOptimize=require("./selectors/simple"),advancedOptimize=require("./selectors/advanced"),simpleStringify=require("./stringifier/simple"),sourceMapStringify=require("./stringifier/source-maps"),CommentsProcessor=require("./text/comments-processor"),ExpressionsProcessor=require("./text/expressions-processor"),FreeTextProcessor=require("./text/free-text-processor"),UrlsProcessor=require("./text/urls-processor"),Compatibility=require("./utils/compatibility"),InputSourceMapTracker=require("./utils/input-source-map-tracker"),SourceTracker=require("./utils/source-tracker"),SourceReader=require("./utils/source-reader"),Validator=require("./properties/validator"),fs=require("fs"),path=require("path"),url=require("url"),override=require("./utils/object").override,DEFAULT_TIMEOUT=5e3,CleanCSS=module.exports=function(e){e=e||{},this.options={advanced:void 0===e.advanced?!0:!!e.advanced,aggressiveMerging:void 0===e.aggressiveMerging?!0:!!e.aggressiveMerging,benchmark:e.benchmark,compatibility:new Compatibility(e.compatibility).toOptions(),debug:e.debug,explicitRoot:!!e.root,explicitTarget:!!e.target,inliner:e.inliner||{},keepBreaks:e.keepBreaks||!1,keepSpecialComments:"keepSpecialComments"in e?e.keepSpecialComments:"*",mediaMerging:void 0===e.mediaMerging?!0:!!e.mediaMerging,processImport:void 0===e.processImport?!0:!!e.processImport,processImportFrom:importOptionsFrom(e.processImportFrom),rebase:void 0===e.rebase?!0:!!e.rebase,relativeTo:e.relativeTo,restructuring:void 0===e.restructuring?!0:!!e.restructuring,root:e.root||process.cwd(),roundingPrecision:e.roundingPrecision,semanticMerging:void 0===e.semanticMerging?!1:!!e.semanticMerging,shorthandCompacting:void 0===e.shorthandCompacting?!0:!!e.shorthandCompacting,sourceMap:e.sourceMap,sourceMapInlineSources:!!e.sourceMapInlineSources,target:!e.target||missingDirectory(e.target)||presentDirectory(e.target)?e.target:path.dirname(e.target)},this.options.inliner.timeout=this.options.inliner.timeout||DEFAULT_TIMEOUT,this.options.inliner.request=override(proxyOptionsFrom(process.env.HTTP_PROXY||process.env.http_proxy),this.options.inliner.request||{})};CleanCSS.prototype.minify=function(e,t){var r={stats:{},errors:[],warnings:[],options:this.options,debug:this.options.debug,localOnly:!t,sourceTracker:new SourceTracker,validator:new Validator(this.options.compatibility)};if(r.options.sourceMap&&(r.inputSourceMapTracker=new InputSourceMapTracker(r)),r.sourceReader=new SourceReader(r,e),e=r.sourceReader.toString(),r.options.processImport||e.indexOf("@shallow")>0){var i=t?process.nextTick:function(e){return e()};return i(function(){return new ImportInliner(r).process(e,{localOnly:r.localOnly,imports:r.options.processImportFrom,whenDone:runMinifier(t,r)})})}return runMinifier(t,r)(e)};
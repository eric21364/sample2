describe("Ultron",function(){"use strict";var i,a,t=require("eventemitter3"),e=require("events").EventEmitter,r=require("assume"),n=require("./");beforeEach(function(){a=new t,i=new n(a)}),afterEach(function(){i.destroy(),a.removeAllListeners()}),it("is exposed as a function",function(){r(n).is.a("function")}),it("can be initialized without the new keyword",function(){r(n(a)).is.instanceOf(n)}),it("assigns a unique id to every instance",function(){for(var t=0;100>t;t++)r(i.id).does.not.equal((new n).id)}),it("allows removal through the event emitter",function(){function t(){}function e(){}i.on("foo",t),i.once("foo",e),r(t.__ultron).equals(i.id),r(e.__ultron).equals(i.id),r(a.listeners("foo").length).equals(2),a.removeListener("foo",t),r(a.listeners("foo").length).equals(1),a.removeListener("foo",e),r(a.listeners("foo").length).equals(0)}),describe("#on",function(){it("assigns a listener",function(){function t(){}r(a.listeners("foo").length).equals(0),i.on("foo",t),r(a.listeners("foo").length).equals(1),r(a.listeners("foo")[0]).equals(t)}),it("tags the assigned function",function(){r(a.listeners("foo").length).equals(0),i.on("foo",function(){}),r(a.listeners("foo")[0].__ultron).equals(i.id)}),it("also passes in the context",function(t){var e=1313;i.on("foo",function(n,i,a){r(n).equals("a"),r(i).equals("b"),r(a).equals("c"),r(this).equals(e),t()},e),a.emit("foo","a","b","c")}),it("works with regular eventemitters as well",function(t){var i=new e,a=new n(i);a.on("foo",function(e,n,i){r(e).equals("a"),r(n).equals("b"),r(i).equals("c"),t()}),i.emit("foo","a","b","c")})}),describe("#once",function(){it("assigns a listener",function(){function t(){}r(a.listeners("foo").length).equals(0),i.once("foo",t),r(a.listeners("foo").length).equals(1),r(a.listeners("foo")[0]).equals(t)}),it("tags the assigned function",function(){r(a.listeners("foo").length).equals(0),i.once("foo",function(){}),r(a.listeners("foo")[0].__ultron).equals(i.id)}),it("also passes in the context",function(t){var e=1313;i.once("foo",function(n,i,a){r(n).equals("a"),r(i).equals("b"),r(a).equals("c"),r(this).equals(e),t()},e),a.emit("foo","a","b","c"),a.emit("foo","a","b","c")}),it("works with regular eventemitters as well",function(t){var i=new e,a=new n(i);a.once("foo",function(e,n,i){r(e).equals("a"),r(n).equals("b"),r(i).equals("c"),t()}),i.emit("foo","a","b","c"),i.emit("foo","a","b","c")})}),describe("#remove",function(){it("removes only our assigned `on` listeners",function(){function t(){}function e(){}a.on("foo",t),i.on("foo",e),r(a.listeners("foo").length).equals(2),i.remove("foo"),r(a.listeners("foo").length).equals(1),r(a.listeners("foo")[0]).equals(t)}),it("removes our private __ultron references",function(){function t(){}function s(){}r("__ultron"in t).is["false"](),r("__ultron"in s).is["false"](),i.on("foo",s),i.once("bar",t),r("__ultron"in t).is["true"](),r("__ultron"in s).is["true"](),i.remove("foo, bar"),r("__ultron"in t).is["false"](),r("__ultron"in s).is["false"](),i.destroy(),a=new e,i=new n(a),r("__ultron"in t).is["false"](),r("__ultron"in s).is["false"](),i.on("foo",s),i.once("bar",t),r("__ultron"in t).is["true"](),r("__ultron"in s).is["true"](),i.remove("foo, bar"),r("__ultron"in t).is["false"](),r("__ultron"in s).is["false"]()}),it("removes only our assigned `once` listeners",function(){function t(){}function e(){}a.once("foo",t),i.once("foo",e),r(a.listeners("foo").length).equals(2),i.remove("foo"),r(a.listeners("foo").length).equals(1),r(a.listeners("foo")[0]).equals(t)}),it("removes only our assigned `once` listeners from regular EE",function(){function a(){}function s(){}var t=new e,i=new n(t);t.once("foo",a),i.once("foo",s),r(t.listeners("foo").length).equals(2),i.remove("foo"),r(t.listeners("foo").length).equals(1),r(t.listeners("foo")[0].listener).equals(a)}),it("removes all assigned events if called without args",function(){function t(){}function e(){}i.on("foo",t),i.on("bar",e),r(a.listeners("foo").length).equals(1),r(a.listeners("bar").length).equals(1),i.remove(),r(a.listeners("foo").length).equals(0),r(a.listeners("bar").length).equals(0)}),it("removes multiple listeners based on args",function(){function t(){}function e(){}function n(){}i.on("foo",t),i.on("bar",e),i.on("baz",n),r(a.listeners("foo").length).equals(1),r(a.listeners("bar").length).equals(1),r(a.listeners("baz").length).equals(1),i.remove("foo","bar"),r(a.listeners("foo").length).equals(0),r(a.listeners("bar").length).equals(0),r(a.listeners("baz").length).equals(1)}),it("removes multiple listeners if first arg is seperated string",function(){function t(){}function e(){}function n(){}i.on("foo",t),i.on("bar",e),i.on("baz",n),r(a.listeners("foo").length).equals(1),r(a.listeners("bar").length).equals(1),r(a.listeners("baz").length).equals(1),i.remove("foo, bar"),r(a.listeners("foo").length).equals(0),r(a.listeners("bar").length).equals(0),r(a.listeners("baz").length).equals(1)})}),describe("#destroy",function(){it("removes all listeners",function(){function t(){}function e(){}function n(){}i.on("foo",t),i.on("bar",e),i.on("baz",n),r(a.listeners("foo").length).equals(1),r(a.listeners("bar").length).equals(1),r(a.listeners("baz").length).equals(1),i.destroy(),r(a.listeners("foo").length).equals(0),r(a.listeners("bar").length).equals(0),r(a.listeners("baz").length).equals(0)}),it("removes the .ee reference",function(){r(i.ee).equals(a),i.destroy(),r(i.ee).equals(null)}),it("returns booleans for state indication",function(){r(i.destroy()).is["true"](),r(i.destroy()).is["false"](),r(i.destroy()).is["false"](),r(i.destroy()).is["false"]()})})});
"use strict";function Utf7Codec(e,t){this.iconv=t}function Utf7Encoder(e,t){this.iconv=t.iconv}function Utf7Decoder(e,t){this.iconv=t.iconv,this.inBase64=!1,this.base64Accum=""}function Utf7IMAPCodec(e,t){this.iconv=t}function Utf7IMAPEncoder(e,t){this.iconv=t.iconv,this.inBase64=!1,this.base64Accum=new Buffer(6),this.base64AccumIdx=0}function Utf7IMAPDecoder(e,t){this.iconv=t.iconv,this.inBase64=!1,this.base64Accum=""}exports.utf7=Utf7Codec,exports.unicode11utf7="utf7",Utf7Codec.prototype.encoder=Utf7Encoder,Utf7Codec.prototype.decoder=Utf7Decoder,Utf7Codec.prototype.bomAware=!0;var nonDirectChars=/[^A-Za-z0-9'\(\),-\.\/:\? \n\r\t]+/g;Utf7Encoder.prototype.write=function(e){return new Buffer(e.replace(nonDirectChars,function(e){return"+"+("+"===e?"":this.iconv.encode(e,"utf16-be").toString("base64").replace(/=+$/,""))+"-"}.bind(this)))},Utf7Encoder.prototype.end=function(){};for(var base64Regex=/[A-Za-z0-9\/+]/,base64Chars=[],i=0;256>i;i++)base64Chars[i]=base64Regex.test(String.fromCharCode(i));var plusChar="+".charCodeAt(0),minusChar="-".charCodeAt(0),andChar="&".charCodeAt(0);Utf7Decoder.prototype.write=function(e){for(var t="",r=0,i=this.inBase64,n=this.base64Accum,s=0;s<e.length;s++)if(i){if(!base64Chars[e[s]]){if(s==r&&e[s]==minusChar)t+="+";else{var a=n+e.slice(r,s).toString();t+=this.iconv.decode(new Buffer(a,"base64"),"utf16-be")}e[s]!=minusChar&&s--,r=s+1,i=!1,n=""}}else e[s]==plusChar&&(t+=this.iconv.decode(e.slice(r,s),"ascii"),r=s+1,i=!0);if(i){var a=n+e.slice(r).toString(),o=a.length-a.length%8;n=a.slice(o),a=a.slice(0,o),t+=this.iconv.decode(new Buffer(a,"base64"),"utf16-be")}else t+=this.iconv.decode(e.slice(r),"ascii");return this.inBase64=i,this.base64Accum=n,t},Utf7Decoder.prototype.end=function(){var e="";return this.inBase64&&this.base64Accum.length>0&&(e=this.iconv.decode(new Buffer(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",e},exports.utf7imap=Utf7IMAPCodec,Utf7IMAPCodec.prototype.encoder=Utf7IMAPEncoder,Utf7IMAPCodec.prototype.decoder=Utf7IMAPDecoder,Utf7IMAPCodec.prototype.bomAware=!0,Utf7IMAPEncoder.prototype.write=function(e){for(var t=this.inBase64,r=this.base64Accum,i=this.base64AccumIdx,n=new Buffer(5*e.length+10),s=0,a=0;a<e.length;a++){var o=e.charCodeAt(a);o>=32&&126>=o?(t&&(i>0&&(s+=n.write(r.slice(0,i).toString("base64").replace(/\//g,",").replace(/=+$/,""),s),i=0),n[s++]=minusChar,t=!1),t||(n[s++]=o,o===andChar&&(n[s++]=minusChar))):(t||(n[s++]=andChar,t=!0),t&&(r[i++]=o>>8,r[i++]=255&o,i==r.length&&(s+=n.write(r.toString("base64").replace(/\//g,","),s),i=0)))}return this.inBase64=t,this.base64AccumIdx=i,n.slice(0,s)},Utf7IMAPEncoder.prototype.end=function(){var e=new Buffer(10),t=0;return this.inBase64&&(this.base64AccumIdx>0&&(t+=e.write(this.base64Accum.slice(0,this.base64AccumIdx).toString("base64").replace(/\//g,",").replace(/=+$/,""),t),this.base64AccumIdx=0),e[t++]=minusChar,this.inBase64=!1),e.slice(0,t)};var base64IMAPChars=base64Chars.slice();base64IMAPChars[",".charCodeAt(0)]=!0,Utf7IMAPDecoder.prototype.write=function(e){for(var t="",r=0,i=this.inBase64,n=this.base64Accum,s=0;s<e.length;s++)if(i){if(!base64IMAPChars[e[s]]){if(s==r&&e[s]==minusChar)t+="&";else{var a=n+e.slice(r,s).toString().replace(/,/g,"/");t+=this.iconv.decode(new Buffer(a,"base64"),"utf16-be")}e[s]!=minusChar&&s--,r=s+1,i=!1,n=""}}else e[s]==andChar&&(t+=this.iconv.decode(e.slice(r,s),"ascii"),r=s+1,i=!0);if(i){var a=n+e.slice(r).toString().replace(/,/g,"/"),o=a.length-a.length%8;n=a.slice(o),a=a.slice(0,o),t+=this.iconv.decode(new Buffer(a,"base64"),"utf16-be")}else t+=this.iconv.decode(e.slice(r),"ascii");return this.inBase64=i,this.base64Accum=n,t},Utf7IMAPDecoder.prototype.end=function(){var e="";return this.inBase64&&this.base64Accum.length>0&&(e=this.iconv.decode(new Buffer(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",e};